<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tamagotchi üê£ | Solana Devnet V2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .devnet-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8em;
            display: inline-block;
            margin-top: 5px;
            font-weight: bold;
        }

        .wallet-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .connect-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .connect-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .wallet-connected {
            color: white;
            font-size: 0.9em;
        }

        .pet-display {
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            min-height: 250px;
        }

        .pet-sprite {
            font-size: 120px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .pet-name {
            font-size: 1.5em;
            color: #667eea;
            margin-top: 15px;
            font-weight: bold;
        }

        .pet-level {
            font-size: 1em;
            color: #764ba2;
            margin-top: 5px;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-bar-container {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }

        .stat-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: white;
            font-weight: bold;
        }

        .stat-bar.health { background: linear-gradient(90deg, #ff6b6b, #ee5a6f); }
        .stat-bar.hunger { background: linear-gradient(90deg, #ffa502, #ff6348); }
        .stat-bar.happiness { background: linear-gradient(90deg, #ffd32a, #ffb142); }
        .stat-bar.energy { background: linear-gradient(90deg, #48dbfb, #0abde3); }

        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: bold;
            color: #667eea;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 50px;
            border-radius: 25px;
            font-size: 1.3em;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .start-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê£ Crypto Tamagotchi</h1>
            <div class="devnet-badge">üß™ DEVNET V2 - BLOCKCHAIN</div>
            <p style="color: #764ba2; margin-top: 10px;">–†–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞ devnet!</p>
            <p style="color: #4caf50; margin-top: 5px; font-size: 0.9em;">‚ú® V2: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ!</p>
        </div>

        <div class="wallet-section" id="walletSection">
            <button class="connect-btn" id="connectWalletBtn" onclick="connectWallet()">
                üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫ (Devnet)
            </button>
            <div id="walletInfo" class="wallet-connected" style="display: none;">
                <div id="walletAddress"></div>
                <button class="connect-btn" onclick="disconnectWallet()" style="margin-top: 10px; background: #ff6b6b;">
                    üîå –û—Ç–∫–ª—é—á–∏—Ç—å
                </button>
            </div>
        </div>

        <div id="startScreen" class="start-screen" style="text-align: center;">
            <div class="pet-display">
                <div style="font-size: 100px;">ü•ö</div>
                <p style="margin-top: 20px; color: #667eea; font-size: 1.2em;">
                    –ù–∞—á–Ω–∏ —Å–≤–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!
                </p>
            </div>
            <button class="start-btn" id="startBtn" onclick="createPet()">
                üéÆ –ó–∞–≤–µ—Å—Ç–∏ –ø–∏—Ç–æ–º—Ü–∞
            </button>
            <p style="text-align: center; margin-top: 15px; color: #4CAF50; font-size: 0.9em; font-weight: bold;">
                ‚ú® –°–æ–∑–¥–∞–Ω–∏–µ –ë–ï–°–ü–õ–ê–¢–ù–û! –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
            </p>
        </div>

        <div id="gameScreen" style="display: none;">
            <div class="pet-display" id="petDisplay">
                <div class="pet-sprite" id="petSprite">üê£</div>
                <div class="pet-name" id="petName">–ü–∏—Ç–æ–º–µ—Ü</div>
                <div class="pet-level" id="petLevel">–£—Ä–æ–≤–µ–Ω—å 1</div>
            </div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-label">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar health" id="healthBar">100%</div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">üçñ –ì–æ–ª–æ–¥</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar hunger" id="hungerBar">100%</div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">üòä –°—á–∞—Å—Ç—å–µ</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar happiness" id="happinessBar">100%</div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar energy" id="energyBar">100%</div>
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="action-btn" onclick="feedPet()">üçñ –ö–æ—Ä–º–∏—Ç—å</button>
                <button class="action-btn" onclick="playWithPet()">üéÆ –ò–≥—Ä–∞—Ç—å</button>
                <button class="action-btn" onclick="healPet()">üíä –õ–µ—á–∏—Ç—å</button>
                <button class="action-btn" onclick="restPet()">üò¥ –°–ø–∞—Ç—å</button>
            </div>

            <div class="info-panel" id="petInfoPanel" style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border: 2px solid #667eea;">
                <div style="text-align: center; font-weight: bold; color: #667eea; margin-bottom: 10px; font-size: 1.1em;">
                    üê£ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ü–∏—Ç–æ–º–µ—Ü (Blockchain)
                </div>
                <div class="info-row">
                    <span class="info-label">üÜî Pet ID:</span>
                    <span class="info-value" id="petId">#????</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üß¨ DNA:</span>
                    <span class="info-value" id="petDna">...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‚ú® –†–µ–¥–∫–æ—Å—Ç—å:</span>
                    <span class="info-value" id="petRarity">‚≠ê</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üé® –í–∏–¥:</span>
                    <span class="info-value" id="petSpecies">...</span>
                </div>
                <div class="info-row">
                    <span class="info-label">üìä –£—Ä–æ–≤–µ–Ω—å:</span>
                    <span class="info-value" id="petLevelInfo">1</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‚≠ê –û–ø—ã—Ç:</span>
                    <span class="info-value" id="petExp">0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">‚è∞ –í–æ–∑—Ä–∞—Å—Ç:</span>
                    <span class="info-value" id="petAge">0</span>
                </div>
                <button class="action-btn" onclick="refreshPet()" style="width: 100%; margin-top: 10px;">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <!-- Anchor (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º) -->
    <script src="https://unpkg.com/@coral-xyz/anchor@0.30.1/dist/browser/index.js"></script>

    <script>
        // üéØ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø - –í–ê–® –ö–û–ù–¢–†–ê–ö–¢!
        const PROGRAM_ID = 'uY5hZR2uYzkquJDuDkFBj29tfzZRPE96BBTHYGaYnwX';
        const RPC_URL = 'https://api.devnet.solana.com';
        
        // Anchor IDL (–æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)
        const IDL = {
            "version": "0.1.0",
            "name": "tamagotchi",
            "instructions": [
                {
                    "name": "createPet",
                    "accounts": [
                        { "name": "pet", "isMut": true, "isSigner": false },
                        { "name": "owner", "isMut": true, "isSigner": true },
                        { "name": "systemProgram", "isMut": false, "isSigner": false }
                    ],
                    "args": []
                },
                {
                    "name": "feedPet",
                    "accounts": [
                        { "name": "pet", "isMut": true, "isSigner": false },
                        { "name": "owner", "isMut": true, "isSigner": true }
                    ],
                    "args": []
                },
                {
                    "name": "playWithPet",
                    "accounts": [
                        { "name": "pet", "isMut": true, "isSigner": false },
                        { "name": "owner", "isMut": true, "isSigner": true }
                    ],
                    "args": []
                },
                {
                    "name": "healPet",
                    "accounts": [
                        { "name": "pet", "isMut": true, "isSigner": false },
                        { "name": "owner", "isMut": true, "isSigner": true }
                    ],
                    "args": []
                },
                {
                    "name": "restPet",
                    "accounts": [
                        { "name": "pet", "isMut": true, "isSigner": false },
                        { "name": "owner", "isMut": true, "isSigner": true }
                    ],
                    "args": []
                }
            ],
            "accounts": [
                {
                    "name": "Pet",
                    "type": {
                        "kind": "struct",
                        "fields": [
                            { "name": "owner", "type": "publicKey" },
                            { "name": "dna", "type": "u64" },
                            { "name": "petId", "type": "u32" },
                            { "name": "species", "type": "u8" },
                            { "name": "accessory", "type": "u8" },
                            { "name": "background", "type": "u8" },
                            { "name": "rarity", "type": "u8" },
                            { "name": "level", "type": "u8" },
                            { "name": "experience", "type": "u16" },
                            { "name": "health", "type": "u8" },
                            { "name": "hunger", "type": "u8" },
                            { "name": "happiness", "type": "u8" },
                            { "name": "energy", "type": "u8" },
                            { "name": "age", "type": "u32" },
                            { "name": "birthTime", "type": "i64" },
                            { "name": "lastActionTime", "type": "i64" },
                            { "name": "lastDecayTime", "type": "i64" },
                            { "name": "actionsCount", "type": "u32" },
                            { "name": "isAlive", "type": "bool" },
                            { "name": "bump", "type": "u8" }
                        ]
                    }
                }
            ]
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let connection;
        let provider;
        let program;
        let wallet = null;
        let petAccount = null;

        // –†–µ–¥–∫–æ—Å—Ç–∏
        const RARITY_NAMES = ['Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'];
        const RARITY_STARS = ['‚≠ê', '‚≠ê‚≠ê', '‚≠ê‚≠ê‚≠ê', '‚≠ê‚≠ê‚≠ê‚≠ê', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'];
        
        // –í–∏–¥—ã –ø–∏—Ç–æ–º—Ü–µ–≤
        const SPECIES_EMOJI = ['üê£', 'üê±', 'üê∂', 'üêâ', 'ü¶ä', 'üêª', 'üê∞', 'üêº', 'ü¶ù', 'üêπ'];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            connection = new window.solanaWeb3.Connection(RPC_URL, 'confirmed');
            console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Solana Devnet');
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
        async function connectWallet() {
            try {
                if (!window.solana || !window.solana.isPhantom) {
                    showNotification("‚ùå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Phantom –∫–æ—à–µ–ª–µ–∫!");
                    window.open('https://phantom.app/', '_blank');
                    return;
                }

                const resp = await window.solana.connect();
                wallet = window.solana;
                
                // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Anchor provider
                const anchorProvider = new window.anchor.AnchorProvider(
                    connection,
                    wallet,
                    { commitment: 'confirmed' }
                );
                
                // –°–æ–∑–¥–∞—Ç—å program instance
                program = new window.anchor.Program(
                    IDL,
                    new window.solanaWeb3.PublicKey(PROGRAM_ID),
                    anchorProvider
                );
                
                const publicKey = resp.publicKey.toString();
                
                document.getElementById('connectWalletBtn').style.display = 'none';
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('walletAddress').innerHTML = `‚úÖ ${publicKey.slice(0, 4)}...${publicKey.slice(-4)}`;
                
                showNotification("‚úÖ –ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω!");
                
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–∏—Ç–æ–º–µ—Ü
                await checkExistingPet();
                
            } catch (err) {
                showNotification("‚ùå –û—à–∏–±–∫–∞: " + err.message);
                console.error(err);
            }
        }

        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
        async function disconnectWallet() {
            try {
                if (wallet) {
                    await wallet.disconnect();
                }
                wallet = null;
                program = null;
                
                document.getElementById('connectWalletBtn').style.display = 'block';
                document.getElementById('walletInfo').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
                
                showNotification("üëã –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω!");
            } catch (err) {
                console.error(err);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        async function checkExistingPet() {
            try {
                const [petPda] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [Buffer.from("pet"), wallet.publicKey.toBuffer()],
                    new window.solanaWeb3.PublicKey(PROGRAM_ID)
                );

                const pet = await program.account.pet.fetch(petPda);
                
                if (pet) {
                    petAccount = pet;
                    document.getElementById('startScreen').style.display = 'none';
                    document.getElementById('gameScreen').style.display = 'block';
                    updateDisplay(pet);
                    showNotification("üéâ –í–∞—à –ø–∏—Ç–æ–º–µ—Ü —Ä–∞–¥ –≤–∏–¥–µ—Ç—å –≤–∞—Å!");
                }
            } catch (err) {
                console.log('‚ÑπÔ∏è –ü–∏—Ç–æ–º–µ—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω - –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ!');
            }
        }

        // –°–æ–∑–¥–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞
        async function createPet() {
            if (!wallet) {
                showNotification("‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫!");
                return;
            }

            try {
                showNotification("üê£ –°–æ–∑–¥–∞—é —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞...");
                document.getElementById('startBtn').disabled = true;

                const [petPda] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [Buffer.from("pet"), wallet.publicKey.toBuffer()],
                    new window.solanaWeb3.PublicKey(PROGRAM_ID)
                );

                const tx = await program.methods
                    .createPet()
                    .accounts({
                        pet: petPda,
                        owner: wallet.publicKey,
                        systemProgram: window.solanaWeb3.SystemProgram.programId,
                    })
                    .rpc();

                console.log("‚úÖ Create Pet TX:", tx);
                showNotification("‚è≥ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...");
                
                await connection.confirmTransaction(tx, 'confirmed');
                
                // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∏—Ç–æ–º—Ü–∞
                const pet = await program.account.pet.fetch(petPda);
                petAccount = pet;
                
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'block';
                
                updateDisplay(pet);
                showNotification(`üéâ –†–æ–¥–∏–ª—Å—è –ø–∏—Ç–æ–º–µ—Ü #${pet.petId}!`);
                
            } catch (err) {
                showNotification("‚ùå –û—à–∏–±–∫–∞: " + err.message);
                console.error(err);
                document.getElementById('startBtn').disabled = false;
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        function updateDisplay(pet) {
            // –°–ø—Ä–∞–π—Ç
            const species = SPECIES_EMOJI[pet.species] || 'üê£';
            document.getElementById('petSprite').textContent = species;
            
            // –ò–º—è
            document.getElementById('petName').textContent = `–ü–∏—Ç–æ–º–µ—Ü #${pet.petId}`;
            document.getElementById('petLevel').textContent = `–£—Ä–æ–≤–µ–Ω—å ${pet.level}`;
            
            // –°—Ç–∞—Ç—ã
            updateStatBar('healthBar', pet.health);
            updateStatBar('hungerBar', pet.hunger);
            updateStatBar('happinessBar', pet.happiness);
            updateStatBar('energyBar', pet.energy);
            
            // –ò–Ω—Ñ–æ –ø–∞–Ω–µ–ª—å
            document.getElementById('petId').textContent = `#${pet.petId}`;
            document.getElementById('petDna').textContent = pet.dna.toString().slice(0, 10) + '...';
            
            const rarityName = RARITY_NAMES[pet.rarity] || 'Common';
            const rarityStars = RARITY_STARS[pet.rarity] || '‚≠ê';
            document.getElementById('petRarity').textContent = `${rarityName} ${rarityStars}`;
            
            document.getElementById('petSpecies').textContent = species;
            document.getElementById('petLevelInfo').textContent = pet.level;
            document.getElementById('petExp').textContent = pet.experience;
            document.getElementById('petAge').textContent = pet.age;
        }

        function updateStatBar(id, value) {
            const bar = document.getElementById(id);
            bar.style.width = value + '%';
            bar.textContent = value + '%';
        }

        // –ü–æ–ª—É—á–∏—Ç—å PDA –ø–∏—Ç–æ–º—Ü–∞
        async function getPetPda() {
            const [petPda] = await window.solanaWeb3.PublicKey.findProgramAddress(
                [Buffer.from("pet"), wallet.publicKey.toBuffer()],
                new window.solanaWeb3.PublicKey(PROGRAM_ID)
            );
            return petPda;
        }

        // –ö–æ—Ä–º–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞
        async function feedPet() {
            if (!wallet || !petAccount) return;
            
            try {
                showNotification("üçñ –ö–æ—Ä–º–ª—é –ø–∏—Ç–æ–º—Ü–∞...");
                
                const petPda = await getPetPda();
                
                const tx = await program.methods
                    .feedPet()
                    .accounts({
                        pet: petPda,
                        owner: wallet.publicKey,
                    })
                    .rpc();

                await connection.confirmTransaction(tx, 'confirmed');
                await refreshPet();
                showNotification("‚úÖ –ü–∏—Ç–æ–º–µ—Ü –ø–æ–∫–æ—Ä–º–ª–µ–Ω!");
                
            } catch (err) {
                showNotification("‚ùå –û—à–∏–±–∫–∞: " + err.message);
                console.error(err);
            }
        }

        // –ò–≥—Ä–∞—Ç—å —Å –ø–∏—Ç–æ–º—Ü–µ–º
        async function playWithPet() {
            if (!wallet || !petAccount) return;
            
            try {
                showNotification("üéÆ –ò–≥—Ä–∞—é —Å –ø–∏—Ç–æ–º—Ü–µ–º...");
                
                const petPda = await getPetPda();
                
                const tx = await program.methods
                    .playWithPet()
                    .accounts({
                        pet: petPda,
                        owner: wallet.publicKey,
                    })
                    .rpc();

                await connection.confirmTransaction(tx, 'confirmed');
                await refreshPet();
                showNotification("‚úÖ –ü–æ–∏–≥—Ä–∞–ª–∏ —Å –ø–∏—Ç–æ–º—Ü–µ–º!");
                
            } catch (err) {
                showNotification("‚ùå –û—à–∏–±–∫–∞: " + err.message);
                console.error(err);
            }
        }

        // –õ–µ—á–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞
        async function healPet() {
            if (!wallet || !petAccount) return;
            
            try {
                showNotification("üíä –õ–µ—á—É –ø–∏—Ç–æ–º—Ü–∞...");
                
                const petPda = await getPetPda();
                
                const tx = await program.methods
                    .healPet()
                    .accounts({
                        pet: petPda,
                        owner: wallet.publicKey,
                    })
                    .rpc();

                await connection.confirmTransaction(tx, 'confirmed');
                await refreshPet();
                showNotification("‚úÖ –ü–∏—Ç–æ–º–µ—Ü –≤—ã–ª–µ—á–µ–Ω!");
                
            } catch (err) {
                showNotification("‚ùå –û—à–∏–±–∫–∞: " + err.message);
                console.error(err);
            }
        }

        // –û—Ç–¥—ã—Ö –ø–∏—Ç–æ–º—Ü–∞
        async function restPet() {
            if (!wallet || !petAccount) return;
            
            try {
                showNotification("üò¥ –ü–∏—Ç–æ–º–µ—Ü –æ—Ç–¥—ã—Ö–∞–µ—Ç...");
                
                const petPda = await getPetPda();
                
                const tx = await program.methods
                    .restPet()
                    .accounts({
                        pet: petPda,
                        owner: wallet.publicKey,
                    })
                    .rpc();

                await connection.confirmTransaction(tx, 'confirmed');
                await refreshPet();
                showNotification("‚úÖ –ü–∏—Ç–æ–º–µ—Ü –æ—Ç–¥–æ—Ö–Ω—É–ª!");
                
            } catch (err) {
                showNotification("‚ùå –û—à–∏–±–∫–∞: " + err.message);
                console.error(err);
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∏—Ç–æ–º—Ü–∞
        async function refreshPet() {
            if (!wallet) return;
            
            try {
                const petPda = await getPetPda();
                const pet = await program.account.pet.fetch(petPda);
                petAccount = pet;
                updateDisplay(pet);
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', err);
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.innerHTML = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', async () => {
            await init();
            
            // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
            if (window.solana && window.solana.isPhantom) {
                try {
                    const resp = await window.solana.connect({ onlyIfTrusted: true });
                    if (resp) {
                        await connectWallet();
                    }
                } catch (e) {
                    console.log('–ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å');
                }
            }
        });
    </script>
</body>
</html>





