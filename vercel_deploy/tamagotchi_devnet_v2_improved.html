<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>Crypto Tamagotchi üê£ | Play-to-Earn NFT Game on Solana</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Crypto Tamagotchi - unique Play-to-Earn game on Solana. Take care of your NFT pet, earn $TAMA tokens!">
    <meta name="keywords" content="Crypto Tamagotchi, Solana NFT, Play-to-Earn, GameFi, Web3 Game, TAMA Token, Blockchain Game">
    <meta name="author" content="Crypto Tamagotchi Team">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://crypto-tamagotchi.vercel.app/">
    <meta property="og:title" content="Crypto Tamagotchi üê£ | Play-to-Earn NFT Game on Solana">
    <meta property="og:description" content="Take care of your unique NFT pet and earn $TAMA tokens! Play now on Solana blockchain.">
    <meta property="og:image" content="https://crypto-tamagotchi.vercel.app/og-image.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://crypto-tamagotchi.vercel.app/">
    <meta property="twitter:title" content="Crypto Tamagotchi üê£ | Play-to-Earn NFT Game">
    <meta property="twitter:description" content="Take care of your unique NFT pet and earn $TAMA tokens!">
    <meta property="twitter:image" content="https://crypto-tamagotchi.vercel.app/twitter-card.png">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üê£</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        /* üñ•Ô∏è DESKTOP OPTIMIZATION */
        @media (min-width: 1024px) {
            body {
                padding: 60px 40px;
            }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* üé® Floating decorative circles */
        body::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            border-radius: 50%;
            top: -100px;
            left: -100px;
            animation: float1 20s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            bottom: -150px;
            right: -150px;
            animation: float2 25s ease-in-out infinite;
        }

        @keyframes float1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(100px, 100px) scale(1.1); }
        }

        @keyframes float2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-100px, -100px) scale(1.2); }
        }

        /* üé® Glassmorphism Container */
        .container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3), 
                        inset 0 0 0 1px rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 10;
            animation: containerFloat 6s ease-in-out infinite;
        }
        
        /* üñ•Ô∏è Desktop Enhanced Container */
        @media (min-width: 1024px) {
            .container {
                max-width: 600px;
                padding: 40px;
                border-radius: 40px;
                box-shadow: 0 30px 90px rgba(0, 0, 0, 0.4), 
                            inset 0 0 0 1px rgba(255, 255, 255, 0.25);
            }
        }

        @keyframes containerFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* ‚ú® Floating particles/stars */
        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.6;
        }

        .particle:nth-child(1) {
            width: 4px;
            height: 4px;
            top: 20%;
            left: 10%;
            animation: particleFloat 8s ease-in-out infinite;
        }

        .particle:nth-child(2) {
            width: 6px;
            height: 6px;
            top: 60%;
            left: 80%;
            animation: particleFloat 10s ease-in-out infinite 2s;
        }

        .particle:nth-child(3) {
            width: 3px;
            height: 3px;
            top: 40%;
            left: 20%;
            animation: particleFloat 12s ease-in-out infinite 4s;
        }

        .particle:nth-child(4) {
            width: 5px;
            height: 5px;
            top: 80%;
            left: 70%;
            animation: particleFloat 9s ease-in-out infinite 1s;
        }

        .particle:nth-child(5) {
            width: 4px;
            height: 4px;
            top: 30%;
            right: 15%;
            animation: particleFloat 11s ease-in-out infinite 3s;
        }

        .particle:nth-child(6) {
            width: 7px;
            height: 7px;
            top: 70%;
            left: 40%;
            animation: particleFloat 13s ease-in-out infinite 5s;
        }

        @keyframes particleFloat {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
                opacity: 0.6;
            }
            25% { 
                transform: translate(20px, -30px) scale(1.2);
                opacity: 0.8;
            }
            50% { 
                transform: translate(-15px, -50px) scale(0.8);
                opacity: 0.4;
            }
            75% { 
                transform: translate(30px, -20px) scale(1.1);
                opacity: 0.7;
            }
        }

        /* üì± Mobile Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
                border-radius: 25px;
                animation: none; /* –£–±–∏—Ä–∞–µ–º –ø–ª–∞–≤–∞—é—â—É—é –∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
            
            body {
                padding: 10px 5px;
                align-items: flex-start;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: white;
            font-size: clamp(1.5em, 5vw, 2em);
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .devnet-badge {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.75em;
            display: inline-block;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }

        /* üí≥ Wallet Section */
        .wallet-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .connect-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .connect-btn:active {
            transform: scale(0.98);
        }

        @media (hover: hover) {
            .connect-btn:hover {
                transform: scale(1.02);
                box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            }
        }

        .wallet-connected {
            color: #667eea;
            font-size: 0.85em;
            font-weight: 600;
        }

        /* üê£ Pet Display with Rarity Effects */
        .pet-display {
            background: linear-gradient(135deg, rgba(224, 231, 255, 0.9) 0%, rgba(243, 232, 255, 0.9) 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 15px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 600px) {
            .pet-display {
                padding: 20px 15px;
                min-height: 180px;
            }
        }

        /* ‚ú® Rarity Glow Effects */
        .pet-display.rarity-0 { /* Common */
            box-shadow: 0 0 20px rgba(200, 200, 200, 0.5);
        }
        .pet-display.rarity-1 { /* Uncommon */
            box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
            animation: glowGreen 3s ease-in-out infinite;
        }
        .pet-display.rarity-2 { /* Rare */
            box-shadow: 0 0 30px rgba(33, 150, 243, 0.7);
            animation: glowBlue 3s ease-in-out infinite;
        }
        .pet-display.rarity-3 { /* Epic */
            box-shadow: 0 0 35px rgba(156, 39, 176, 0.8);
            animation: glowPurple 3s ease-in-out infinite;
        }
        .pet-display.rarity-4 { /* Legendary */
            box-shadow: 0 0 40px rgba(255, 193, 7, 0.9);
            animation: glowGold 2s ease-in-out infinite;
        }

        @keyframes glowGreen {
            0%, 100% { box-shadow: 0 0 25px rgba(76, 175, 80, 0.6); }
            50% { box-shadow: 0 0 40px rgba(76, 175, 80, 0.9); }
        }

        @keyframes glowBlue {
            0%, 100% { box-shadow: 0 0 30px rgba(33, 150, 243, 0.7); }
            50% { box-shadow: 0 0 45px rgba(33, 150, 243, 1); }
        }

        @keyframes glowPurple {
            0%, 100% { box-shadow: 0 0 35px rgba(156, 39, 176, 0.8); }
            50% { box-shadow: 0 0 50px rgba(156, 39, 176, 1); }
        }

        @keyframes glowGold {
            0%, 100% { box-shadow: 0 0 40px rgba(255, 193, 7, 0.9), 0 0 60px rgba(255, 193, 7, 0.5); }
            50% { box-shadow: 0 0 60px rgba(255, 193, 7, 1), 0 0 80px rgba(255, 193, 7, 0.8); }
        }

        .pet-sprite {
            font-size: clamp(80px, 20vw, 120px);
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.3s;
            user-select: none;
        }

        .pet-sprite:active {
            transform: scale(0.95);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* ‚ö†Ô∏è Critical Stats Pulse Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .stat-critical {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* üíî Shake Animation for Low Health */
        @keyframes shake {
            0%, 100% { transform: translateX(0) translateY(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) translateY(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px) translateY(5px); }
        }

        .pet-sprite.health-critical {
            animation: float 3s ease-in-out infinite, shake 0.5s ease-in-out infinite;
        }

        .pet-name {
            font-size: clamp(1.2em, 4vw, 1.5em);
            color: #667eea;
            margin-top: 10px;
            font-weight: bold;
        }

        .pet-level {
            font-size: clamp(0.9em, 3vw, 1em);
            color: #764ba2;
            margin-top: 5px;
        }

        /* üìä Stats Grid - Responsive */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (max-width: 350px) {
            .stats {
                grid-template-columns: 1fr;
            }
        }

        .stat {
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-bar-container {
            background: #e0e0e0;
            border-radius: 10px;
            height: 18px;
            overflow: hidden;
        }

        .stat-bar {
            height: 100%;
            transition: width 0.5s ease, background 0.3s ease;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* üé® Dynamic Stat Colors */
        .stat-bar.health {
            background: linear-gradient(90deg, #4caf50, #66bb6a);
        }
        .stat-bar.health[data-value="0"],
        .stat-bar.health[data-value="1"],
        .stat-bar.health[data-value="2"] {
            background: linear-gradient(90deg, #f44336, #e53935);
        }
        .stat-bar.health[data-value="3"],
        .stat-bar.health[data-value="4"],
        .stat-bar.health[data-value="5"] {
            background: linear-gradient(90deg, #ff9800, #fb8c00);
        }

        .stat-bar.hunger {
            background: linear-gradient(90deg, #ff9800, #fb8c00);
        }
        .stat-bar.hunger[data-value="0"],
        .stat-bar.hunger[data-value="1"],
        .stat-bar.hunger[data-value="2"] {
            background: linear-gradient(90deg, #f44336, #e53935);
        }

        .stat-bar.happiness {
            background: linear-gradient(90deg, #ffeb3b, #fdd835);
        }
        .stat-bar.happiness[data-value="0"],
        .stat-bar.happiness[data-value="1"],
        .stat-bar.happiness[data-value="2"] {
            background: linear-gradient(90deg, #f44336, #e53935);
        }

        .stat-bar.energy {
            background: linear-gradient(90deg, #2196f3, #42a5f5);
        }

        /* ‚è∞ Realtime Info Panel */
        .realtime-info {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 243, 224, 0.95);
            border-radius: 15px;
            border: 2px solid rgba(255, 152, 0, 0.3);
        }

        .realtime-title {
            text-align: center;
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .decay-timer, .death-prediction {
            text-align: center;
            font-size: 0.85em;
            color: #f57c00;
            margin: 5px 0;
        }

        .recommendations {
            margin-top: 8px;
        }

        .recommendations-title {
            text-align: center;
            font-size: 0.85em;
            color: #e65100;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .recommendations-list {
            font-size: 0.8em;
            color: #f57c00;
        }

        .recommendation-item {
            margin: 3px 0;
            text-align: center;
        }

        /* üéÆ Action Buttons */
        .actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (max-width: 400px) {
            .actions {
                grid-template-columns: 1fr;
            }
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 15px;
            font-size: 0.95em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .action-btn:active {
            transform: scale(0.97);
        }

        @media (hover: hover) {
            .action-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            }
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .token-cost {
            font-size: 0.75em;
            opacity: 0.9;
            margin-top: 3px;
        }

        /* üìú History Panel */
        .history-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 12px;
            margin-bottom: 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .history-panel.show {
            max-height: 300px;
        }

        .history-title {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            padding: 8px;
            margin: 5px 0;
            background: #f5f5f5;
            border-radius: 10px;
            font-size: 0.8em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-action {
            font-weight: 600;
        }

        .history-time {
            color: #999;
            font-size: 0.9em;
        }

        /* üìä Stats Panel */
        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .info-title {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.85em;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-weight: 600;
        }

        .info-value {
            color: #333;
            font-weight: bold;
        }

        /* üí¨ Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(255, 255, 255, 0.98);
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            font-weight: 600;
            z-index: 1000;
            transition: transform 0.3s ease;
            max-width: 90%;
            text-align: center;
            font-size: 0.9em;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        /* üîò Toggle Button */
        .toggle-btn {
            background: rgba(255, 255, 255, 0.95);
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-bottom: 10px;
        }

        .toggle-btn:active {
            transform: scale(0.98);
        }

        /* üé® Progress Bar for Experience */
        .exp-bar-container {
            background: rgba(224, 231, 255, 0.5);
            border-radius: 10px;
            height: 8px;
            margin-top: 8px;
            overflow: hidden;
        }

        .exp-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .exp-text {
            text-align: center;
            font-size: 0.75em;
            color: white;
            margin-top: 3px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* üé® Loading Spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        /* üéØ Close Button */
        .close-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }

        .close-btn:active {
            transform: scale(0.98);
        }

        /* üåô Dark Mode (–¥–ª—è –±—É–¥—É—â–µ–≥–æ) */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        /* –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .hidden {
            display: none !important;
        }

        /* üì± Touch Feedback */
        @media (max-width: 768px) {
            * {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }

            button {
                min-height: 44px; /* iOS touch target */
            }
        }

        /* üì± MOBILE OPTIMIZATION - –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        @media (max-width: 600px) {
            body {
                padding: 10px 5px;
                align-items: flex-start;
                display: block; /* –ú–µ–Ω—è–µ–º —Å flex –Ω–∞ block */
            }

            .container {
                padding: 15px;
                max-width: 100%;
                width: calc(100% - 10px);
                margin: 5px auto;
                border-radius: 20px;
                animation: none; /* –û—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞–≤–∞—é—â—É—é –∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
                position: relative; /* –£–±–∏—Ä–∞–µ–º –ª—é–±–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
                transform: none !important; /* –û—Ç–∫–ª—é—á–∞–µ–º transforms */
            }

            /* üéØ –ö–Ω–æ–ø–∫–∏ –≤ –æ–¥–∏–Ω —Ä—è–¥ –ø–æ 2 */
            .action-buttons {
                display: grid !important;
                grid-template-columns: 1fr 1fr;
                gap: 8px !important;
                margin-top: 15px;
            }

            .action-buttons button {
                width: 100%;
                padding: 12px 8px !important;
                font-size: 14px !important;
                white-space: nowrap;
            }
        }
        
        /* üñ•Ô∏è DESKTOP ENHANCED - –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        @media (min-width: 1024px) {
            /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
            h1 {
                font-size: 36px !important;
                margin-bottom: 15px !important;
            }
            
            h2 {
                font-size: 24px !important;
                margin-bottom: 15px !important;
            }
            
            h3 {
                font-size: 20px !important;
            }
            
            /* Pet Display */
            .pet-display {
                padding: 30px !important;
                margin: 20px 0 !important;
            }
            
            .pet-sprite {
                font-size: 100px !important;
            }
            
            /* –ö–Ω–æ–ø–∫–∏ */
            .action-buttons {
                grid-template-columns: 1fr 1fr !important;
                gap: 15px !important;
                margin-top: 25px !important;
            }
            
            .action-buttons button {
                padding: 18px 20px !important;
                font-size: 16px !important;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .action-buttons button:hover {
                transform: translateY(-5px) scale(1.05);
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            }
            
            .action-buttons button:active {
                transform: translateY(-2px) scale(1.02);
            }
            
            /* Progress bars */
            .stat-bar {
                height: 24px !important;
            }
            
            /* Particles –∞–∫—Ç–∏–≤–Ω—ã */
            .particle {
                display: block !important;
            }

            /* üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–æ */
            .stats-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .stat-item {
                padding: 10px !important;
            }

            .stat-value {
                font-size: 18px !important;
            }

            /* üèÜ Leaderboard –∫–æ–º–ø–∞–∫—Ç–Ω–æ */
            .leaderboard-item {
                padding: 10px !important;
                font-size: 13px !important;
            }

            /* üíæ –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã */
            h1 {
                font-size: 24px !important;
                margin-bottom: 10px !important;
            }

            h2 {
                font-size: 18px !important;
                margin-bottom: 10px !important;
            }

            h3 {
                font-size: 16px !important;
            }

            p {
                font-size: 14px !important;
            }

            /* üê£ Pet display */
            .pet-display {
                padding: 15px !important;
            }

            .pet-sprite {
                font-size: 60px !important;
            }

            /* üìä Progress bars */
            .stat-row {
                margin: 8px 0 !important;
            }

            .stat-bar {
                height: 18px !important;
            }

            /* üé® –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
            .notification {
                bottom: 70px !important;
                left: 10px;
                right: 10px;
                width: auto !important;
            }

            /* ‚ú® Floating particles - –º–µ–Ω—å—à–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .particle {
                display: none; /* –û—Ç–∫–ª—é—á–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
            }

            body::before,
            body::after {
                opacity: 0.3; /* –£–º–µ–Ω—å—à–∞–µ–º —è—Ä–∫–æ—Å—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            }
        }

        /* üì± –û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ò–ï –≠–ö–†–ê–ù–´ (< 400px) */
        @media (max-width: 400px) {
            .container {
                padding: 12px;
                border-radius: 15px;
            }

            .action-buttons button {
                padding: 10px 6px !important;
                font-size: 13px !important;
            }

            h1 {
                font-size: 20px !important;
            }

            .pet-sprite {
                font-size: 50px !important;
            }
        }

    </style>

</head>
<body>
    <!-- ‚ú® Decorative floating particles -->
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>

    <div class="container">
        <div class="header">
            <h1>üê£ Crypto Tamagotchi</h1>
            <span class="devnet-badge">DEVNET - Real-Time</span>
        </div>

        <div class="wallet-section">
            <button class="connect-btn" id="connectBtn" onclick="window.connectWallet()">
                üîó Connect Wallet
            </button>
            <div class="wallet-connected" id="walletAddress" style="display: none; position: relative;">
                <div id="tamaBalance" style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 10px; text-align: center;">
                    <div style="font-size: 18px; font-weight: bold; color: #FFD700;">üéØ TAMA: <span id="tamaAmount">0</span></div>
                    <div style="font-size: 12px; color: #ccc;">Tokens earned from pet actions</div>
                </div>
                <button class="disconnect-btn" onclick="window.disconnectWallet()" style="margin-left: 10px; padding: 8px 15px; background: #ff4444; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 14px;">
                    üö™ Disconnect
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è -->
        <div id="createScreen" style="display: none;">
            <div class="pet-display">
                <div class="pet-sprite" style="font-size: 64px; margin-bottom: 20px;">ü•ö</div>
                
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.2)); padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: #FFD700; font-size: 24px; margin-bottom: 15px;">üéÆ Welcome to Gotchi Game!</h3>
                    
                    <div style="color: #fff; margin-bottom: 20px;">
                        <p style="margin-bottom: 10px;">‚ú® Create your pixel pet</p>
                        <p style="margin-bottom: 10px;">üéÆ Play mini-games</p>
                        <p>üí∞ Earn rewards!</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.2)); padding: 18px; border-radius: 15px; margin-bottom: 15px; text-align: center;">
                    <h3 style="color: #00ff99; margin: 0 0 12px 0; font-size: 16px;">üéÅ Beta Tester Rewards:</h3>
                    <div style="color: #fff; font-size: 13px; line-height: 1.6;">
                        <p style="margin: 0 0 8px 0;">‚Ä¢ Free Mainnet NFT mint</p>
                        <p style="margin: 0 0 8px 0;">‚Ä¢ $GOTCHI token airdrop</p>
                        <p style="margin: 0 0 8px 0;">‚Ä¢ OG Badge (on-chain)</p>
                        <p style="margin: 0;">‚Ä¢ VIP Discord role</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(255,165,0,0.2), rgba(255,140,0,0.2)); padding: 18px; border-radius: 15px; margin-bottom: 15px; text-align: left; border: 2px solid rgba(255,165,0,0.5);">
                    <h3 style="color: #FFA500; margin: 0 0 12px 0; text-align: center; font-size: 16px;">üìù Testing on Devnet:</h3>
                    <div style="color: #fff; font-size: 13px; line-height: 1.5;">
                        <p style="margin: 0 0 8px 0; font-weight: bold;">1. Switch to Devnet</p>
                        <p style="margin: 0 0 12px 0; padding-left: 15px; opacity: 0.9;">‚Ä¢ In Phantom: Settings ‚Üí Change Network ‚Üí Devnet</p>
                        
                        <p style="margin: 0 0 8px 0; font-weight: bold;">2. Get free SOL</p>
                        <p style="margin: 0 0 5px 0; padding-left: 15px; opacity: 0.9;">‚Ä¢ Visit: <a href="https://faucet.solana.com" target="_blank" style="color: #00D4AA; text-decoration: underline; font-weight: 500;">faucet.solana.com</a></p>
                        <p style="margin: 0 0 12px 0; padding-left: 15px; opacity: 0.9;">‚Ä¢ Paste your wallet address & request</p>
                        
                        <p style="margin: 0 0 8px 0; font-weight: bold;">3. Create pet & test!</p>
                        <p style="margin: 0; padding-left: 15px; opacity: 0.9;">‚Ä¢ Connect wallet ‚Üí Create pet ‚Üí Play</p>
                    </div>
                </div>
            </div>

            <div style="margin: 20px 0; text-align: center;">
                <button onclick="createPet()" id="createPetBtn" style="background: linear-gradient(135deg, #00D4AA, #00A8CC); color: white; font-size: 18px; padding: 20px 30px; border: none; border-radius: 15px; cursor: pointer; width: 100%; max-width: 400px; font-weight: bold; box-shadow: 0 8px 32px rgba(0, 212, 170, 0.3); margin-bottom: 15px;">
                    üê£ Create Your Pet (FREE)
                </button>

                <p style="color: #fff; opacity: 0.9; font-size: 13px; margin-bottom: 5px;">
                    ‚úÖ Free beta testing on Devnet
                </p>
                <p style="color: #fff; opacity: 0.9; font-size: 13px; margin-bottom: 5px;">
                    üíé Beta testers get exclusive rewards
                </p>
                <p style="color: #fff; opacity: 0.8; font-size: 13px;">
                    üéÆ Mainnet launch with REAL NFTs coming soon!
                </p>
            </div>

            <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: center;">
                <p style="color: #fff; opacity: 0.7; font-size: 0.85em; margin: 0;">
                    üí° This is a beta test on Devnet. All progress will be reset before Mainnet launch.
                </p>
            </div>
            
            <!-- Manual Refresh –∫–Ω–æ–ø–∫–∞ -->
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div id="gameScreen" style="display: none;">
            <div class="pet-display" id="petDisplay">
                <div class="pet-sprite" id="petSprite">üê£</div>
                <div class="pet-name" id="petName">Pet</div>
                <div class="pet-level" id="petLevel">Level 1</div>
                <div class="pet-lives" id="petLives" style="font-size: 20px; margin-top: 5px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                
                <!-- üçñ AUTO-FEED MECHANICS -->
                <div class="click-stats" style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="color: #4caf50; font-weight: bold;">üçñ Auto-Feeders: <span id="autoFeedCount">0</span></span>
                        <span style="color: #00d4ff; font-weight: bold;">‚è± Next Feed: <span id="nextFeedTime">--</span></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #ff9800; font-weight: bold; font-size: 13px;">Prevents hunger decay automatically</span>
                    </div>
                </div>
                <div class="exp-bar-container">
                    <div class="exp-bar" id="expBar" style="width: 0%"></div>
                </div>
                <div class="exp-text" id="expText">EXP: 0 / 100</div>
            </div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-label">‚ù§Ô∏è Health</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar health" id="healthBar" data-value="10">100%</div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">üçñ Hunger</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar hunger" id="hungerBar" data-value="10">100%</div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">üòä Happiness</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar happiness" id="happinessBar" data-value="10">100%</div>
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-label">‚ö° Energy</div>
                    <div class="stat-bar-container">
                        <div class="stat-bar energy" id="energyBar" data-value="10">100%</div>
                    </div>
                </div>
            </div>

            <!-- Real-time info -->
            <div class="realtime-info">
                <div class="realtime-title">‚è∞ Real-Time Status</div>
                <div class="death-prediction" id="deathPrediction" style="display: none;">üíÄ Prediction: --</div>
                <div class="recommendations" id="recommendations" style="display: none;">
                    <div class="recommendations-title">üí° Recommendations:</div>
                    <div class="recommendations-list" id="recommendationsList"></div>
                </div>
            </div>

            <!-- Actions -->
            <div class="actions action-buttons">
                <button class="action-btn" onclick="feedPet()" id="feedBtn">
                    üçñ Feed
                    <div class="token-cost">5 TAMA</div>
                </button>
                <button class="action-btn" onclick="playWithPet()" id="playBtn">
                    üéÆ Play
                    <div class="token-cost">3 TAMA</div>
                </button>
                <button class="action-btn" onclick="healPet()" id="healBtn">
                    üíä Heal
                    <div class="token-cost">8 TAMA</div>
                </button>
                <button class="action-btn" onclick="restPet()" id="restBtn">
                    üò¥ Rest
                    <div class="token-cost">2 TAMA</div>
                </button>
                
                <!-- üçñ AUTO-FEED -->
                <button class="action-btn" onclick="buyAutoFeed()" id="autoFeedBtn" style="background: linear-gradient(135deg, #4caf50, #45a049);">
                    üçñ Auto-Feed
                    <div class="token-cost" id="autoFeedCost">50 TAMA</div>
                </button>
            </div>
            
            <!-- üíÄ RESURRECTION (only for dead pets) -->
            <div class="resurrection-panel" id="resurrectionPanel" style="display: none;">
                <div style="background: rgba(255,0,0,0.1); border: 2px solid #ff4444; border-radius: 15px; padding: 20px; margin: 15px 0;">
                    <h3 style="color: #ff4444; text-align: center; margin-bottom: 15px;">üíÄ Your pet died!</h3>
                    <p style="text-align: center; color: white; margin-bottom: 20px;">
                        Choose an action:
                    </p>
                    
                    <div style="display: grid; gap: 10px;">
                        <!-- FREE Resurrection (once) -->
                        <button class="action-btn" onclick="resurrectFree()" id="resurrectFreeBtn" style="background: linear-gradient(135deg, #4caf50, #8bc34a);">
                            üéÅ FREE Resurrection
                            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.9;">Restores with 50% stats (once per pet)</div>
                        </button>
                        
                        <!-- Close Account -->
                        <button class="action-btn" onclick="closePetAccount()" id="closeAccountBtn" style="background: linear-gradient(135deg, #434343, #000000);">
                            ‚ö∞Ô∏è Close Account
                            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.9;">Get rent back & create new pet</div>
                        </button>
                    </div>
                    
                    <p style="text-align: center; color: #ff4444; margin-top: 15px; font-size: 0.85em;">
                        ‚ö†Ô∏è Closing account deletes pet forever!
                    </p>
                </div>
            </div>

            <!-- Explorer Link -->
            <button class="close-btn hidden" id="closeBtn" onclick="closePetAccount()">
                üíÄ –ó–∞–∫—Ä—ã—Ç—å –∞–∫–∫–∞—É–Ω—Ç (–≤–µ—Ä–Ω—É—Ç—å rent)
            </button>

            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ Explorer -->
            <div style="text-align: center; margin-top: 15px;">
                <a href="#" id="petAccountLink" target="_blank" style="color: white; text-decoration: none; font-size: 0.85em; text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);">
                    üîç –°–º–æ—Ç—Ä–µ—Ç—å –≤ Explorer
                </a>
            </div>
        </div>
    </div>

    <!-- üìä GAME STATS SECTION -->
    <div class="container" style="margin-top: 20px;">
        <h2 style="text-align: center; color: white; margin-bottom: 20px;">üìä Game Statistics</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: white;" id="totalPets">...</div>
                <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-top: 5px;">Total Pets</div>
            </div>
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 20px; border-radius: 15px; text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: white;" id="totalPlayers">...</div>
                <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-top: 5px;">Players</div>
            </div>
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 20px; border-radius: 15px; text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: white;" id="activeNow">...</div>
                <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-top: 5px;">Active Now</div>
            </div>
            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); padding: 20px; border-radius: 15px; text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: white;" id="popularSpecies">...</div>
                <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-top: 5px;">Most Popular</div>
            </div>
        </div>
    </div>

    <!-- üèÜ LEADERBOARD SECTION -->
    <div class="container" style="margin-top: 20px;">
        <h2 style="text-align: center; color: white; margin-bottom: 20px;">üèÜ Top Players</h2>
        <div id="leaderboard-container" style="max-height: 400px; overflow-y: auto;">
            <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
                Loading leaderboard...
            </div>
        </div>
    </div>

    <!-- üìú ACTION HISTORY SECTION -->
    <div class="container" style="margin-top: 20px;">
        <h2 style="text-align: center; color: white; margin-bottom: 15px;">üìú Your Action History</h2>
        <p style="text-align: center; color: white; margin-bottom: 20px; font-size: 14px; opacity: 0.8;">
            Powered by Cloudflare KV Database üíæ
        </p>
        
        <button onclick="loadHistory()" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none; padding: 15px 30px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; width: 100%; margin-bottom: 15px;">
            üîÑ Load History
        </button>
        
        <div id="historyList" style="max-height: 400px; overflow-y: auto;">
            <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
                Click "Load History" to see your actions
            </div>
        </div>
    </div>

    <!-- ü§ñ AI ADVISOR SECTION -->
    <div class="container" style="margin-top: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <h2 style="text-align: center; color: white; margin-bottom: 15px;">ü§ñ AI Advisor - Ask for Help!</h2>
        <p style="text-align: center; color: white; margin-bottom: 20px; font-size: 14px; opacity: 0.9;">
            Powered by Cloudflare Workers AI üîÆ
        </p>
        
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
            <textarea 
                id="aiQuestion" 
                placeholder="Ask anything: 'What should I do?', 'How to level up faster?', 'My pet looks sad...'"
                style="width: 100%; min-height: 80px; padding: 15px; border-radius: 10px; border: none; font-size: 14px; resize: vertical; font-family: inherit;"
            ></textarea>
        </div>
        
        <button onclick="askAIAdvisor()" style="background: white; color: #667eea; border: none; padding: 15px 30px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; width: 100%; margin-bottom: 15px; transition: transform 0.2s;">
            ü§ñ Ask AI
        </button>
        
        <div id="aiResponse" style="display: none; background: rgba(255,255,255,0.15); padding: 20px; border-radius: 15px; margin-top: 15px;">
            <h3 style="color: white; margin-bottom: 10px; font-size: 16px;">üí° AI Advice:</h3>
            <p id="aiAdviceText" style="color: white; line-height: 1.6; font-size: 14px;"></p>
        </div>
    </div>

    <!-- üéÅ REFERRAL SECTION -->
    <div class="container" style="margin-top: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <h2 style="text-align: center; color: white; margin-bottom: 15px;">üéÅ Invite Friends & Earn Rewards</h2>
        <p style="text-align: center; color: white; margin-bottom: 20px; font-size: 16px;">
            Get <strong id="referralBonus" style="font-size: 24px;">100</strong> TAMA for each friend!
        </p>
        
        <button onclick="createReferralLink()" style="background: white; color: #f5576c; border: none; padding: 15px 30px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; width: 100%; margin-bottom: 15px; transition: transform 0.2s;">
            üîó Generate Referral Link
        </button>
        
        <div id="referralResult" style="display: none; margin-top: 15px;">
            <p style="color: white; margin-bottom: 10px;">
                Your code: <strong id="referralCode" style="font-size: 18px; color: #FFD700;">-</strong>
            </p>
            <div style="display: flex; gap: 10px;">
                <input 
                    type="text" 
                    id="referralLink" 
                    readonly 
                    style="flex: 1; padding: 12px; border-radius: 8px; border: none; font-size: 14px; font-family: monospace;"
                >
                <button onclick="copyReferralLink()" style="background: #FFD700; color: #f5576c; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; white-space: nowrap;">
                    üìã Copy
                </button>
            </div>
        </div>
    </div>

    <!-- üí¨ COMMUNITY CHAT SECTION -->
    <div class="container" style="margin-top: 20px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
        <h2 style="text-align: center; color: white; margin-bottom: 15px;">üí¨ Community Chat</h2>
        <p style="text-align: center; color: white; margin-bottom: 20px; font-size: 14px; opacity: 0.9;">
            Chat with other Tamagotchi players! üéÆ
        </p>
        
        <!-- Chat Messages -->
        <div id="chatMessages" style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 15px; margin-bottom: 15px; max-height: 400px; overflow-y: auto; min-height: 250px;">
            <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                <p style="font-size: 48px; margin-bottom: 10px;">üí¨</p>
                <p>Connect wallet to chat with players!</p>
            </div>
        </div>
        
        <!-- Chat Input -->
        <div style="display: flex; gap: 10px;">
            <input 
                type="text" 
                id="chatInput" 
                placeholder="Type your message..."
                maxlength="200"
                style="flex: 1; padding: 15px; border-radius: 12px; border: none; font-size: 14px; font-family: inherit;"
                onkeypress="if(event.key==='Enter') sendChatMessage()"
            >
            <button onclick="sendChatMessage()" style="background: white; color: #43e97b; border: none; padding: 15px 25px; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; white-space: nowrap; transition: transform 0.2s;">
                üì§ Send
            </button>
        </div>
        
        <p style="text-align: center; color: rgba(255,255,255,0.7); margin-top: 10px; font-size: 12px;">
            Messages are stored in Cloudflare KV ‚Ä¢ Max 200 characters
        </p>
    </div>

    <div class="notification" id="notification"></div>

    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.js"></script>

    <script>
        // üéØ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const PROGRAM_ID = 'uY5hZR2uYzkquJDuDkFBj29tfzZRPE96BBTHYGaYnwX';
        
        // üí∞ TREASURY WALLET (–∫–æ–º–∞–Ω–¥–∞)
        const TREASURY_WALLET = '49kwEKNBnfqYt4GYpYkcCHyDiQDxS24jRuckLjptryvu';
        
        // ‚ö° CLOUDFLARE WORKERS API
        const WORKERS_API = 'https://my-vibe-sdk.travkevich.workers.dev';
        
        const RPC_URLS = [
            'https://api.devnet.solana.com',
            'https://rpc.ankr.com/solana_devnet'
        ];
        
        // üéØ TAMA Token System
        const TAMA_MINT = 'TAMA_MINT_PDA'; // –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
        const TOKEN_MINT = '74KGR9mdiiiqVW9QCnFmZz8cyj39ZoCaKexrSxF8fpQD'; // TAMA Token (Devnet)
        const TOKEN_PROGRAM_ID = 'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA';
        
        // üí∞ –ê–î–ú–ò–ù–ö–ê - –¶–ï–ù–´ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)
        let PRICES = {
            NFT_SOL: 0.01,        // SOL –∑–∞ NFT –ø–∏—Ç–æ–º—Ü–∞
            FEED_TAMA: 5,         // TAMA –∑–∞ –∫–æ—Ä–º–ª–µ–Ω–∏–µ
            PLAY_TAMA: 3,         // TAMA –∑–∞ –∏–≥—Ä—É
            HEAL_TAMA: 8,         // TAMA –∑–∞ –ª–µ—á–µ–Ω–∏–µ
            REST_TAMA: 2,         // TAMA –∑–∞ –æ—Ç–¥—ã—Ö
            RESURRECT_SOL: 0.5,   // SOL –∑–∞ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ
            RESURRECT_TAMA: 5000  // TAMA –∑–∞ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ
        };
        
        // üëë –ê–î–ú–ò–ù –ö–û–®–ï–õ–¨–ö–ò (–º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Ü–µ–Ω—ã)
        const ADMIN_WALLETS = [
            '3FoxkxofKn9r79RjP5skNA2vpHLwngATA4gp77vwbLMB', // –û—Å–Ω–æ–≤–Ω–æ–π –∞–¥–º–∏–Ω
            'H2a7hSCumPuFGVV9yvzABxbTBnt9N3VWLyRrwjKrYJ7i', // –¢–≤–æ–π –∞–¥–º–∏–Ω –∫–æ—à–µ–ª–µ–∫
        ];
        
        // üí∞ TREASURY WALLETS
        const TEAM_WALLET = '2eyQycA4d4zu3FbbwdvHuJ1fVDcfQsz78qGdKGYa8NXw';
        const MARKETING_WALLET = '2eyQycA4d4zu3FbbwdvHuJ1fVDcfQsz78qGdKGYa8NXw'; // –ü–æ–∫–∞ —Ç–æ—Ç –∂–µ
        const LIQUIDITY_WALLET = '2eyQycA4d4zu3FbbwdvHuJ1fVDcfQsz78qGdKGYa8NXw'; // –ü–æ–∫–∞ —Ç–æ—Ç –∂–µ
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        var connection = null;
        var wallet = null;
        var petPubkey = null;
        var realPetData = null;
        var realtimeUpdateInterval = null;
        var actionHistory = [];
        
        // üî• ADDICTED.FUN STYLE –ú–ï–•–ê–ù–ò–ö–ò
        var clickCount = 0;
        var totalClicks = 0;
        var autoClickers = 0;
        var autoClickInterval = null;
        var entryFeePaid = false;
        var lastLoginTime = Date.now();
        
        // ü§ñ –ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä –ª–∏–º–∏—Ç—ã
        const MAX_AUTO_CLICKERS = 20;
        const AUTO_CLICKER_BASE_COST = 100;
        const AUTO_CLICKER_MULTIPLIER = 1.5;
        const CLICKS_PER_SECOND = 1; // –°–∫–æ–ª—å–∫–æ –∫–ª–∏–∫–æ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É –¥–∞–µ—Ç 1 –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä
        const MAX_OFFLINE_HOURS = 24; // –ú–∞–∫—Å–∏–º—É–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è offline
        
        // üí∞ REFERRAL SYSTEM
        var referralCode = '';
        var referredBy = '';
        var totalReferrals = 0;
        var referralEarnings = 0;
        
        // ‚ù§Ô∏è LIVES SYSTEM (3 –∂–∏–∑–Ω–∏)
        var petLives = 3; // –ù–∞—á–∏–Ω–∞–µ–º —Å 3 –∂–∏–∑–Ω–µ–π
        var deathCount = 0; // –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ —É–º–∏—Ä–∞–ª
        
        // üêæ 10 —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤ –∂–∏–≤–æ—Ç–Ω—ã—Ö
        const SPECIES_EMOJI = {
            0: 'üê±', // –ö–æ—à–∫–∞
            1: 'üê∂', // –°–æ–±–∞–∫–∞
            2: 'üê∞', // –ö—Ä–æ–ª–∏–∫
            3: 'üêª', // –ú–µ–¥–≤–µ–¥—å
            4: 'ü¶ä', // –õ–∏—Å–∞
            5: 'üêº', // –ü–∞–Ω–¥–∞
            6: 'üêπ', // –•–æ–º—è–∫
            7: 'üê∏', // –õ—è–≥—É—à–∫–∞
            8: 'üê¢', // –ß–µ—Ä–µ–ø–∞—Ö–∞
            9: 'ü¶â'  // –°–æ–≤–∞
        };

        
        const RARITY_NAMES = {
            0: 'Common',
            1: 'Uncommon',
            2: 'Rare',
            3: 'Epic',
            4: 'Legendary'
        };
        
        const RARITY_STARS = {
            0: '‚≠ê',
            1: '‚≠ê‚≠ê',
            2: '‚≠ê‚≠ê‚≠ê',
            3: '‚≠ê‚≠ê‚≠ê‚≠ê',
            4: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'
        };

        // Buffer polyfill
        function stringToBytes(str) {
            return new TextEncoder().encode(str);
        }

        // –í—ã—á–∏—Å–ª–∏—Ç—å Anchor discriminator
        async function getInstructionDiscriminator(instructionName) {
            const encoder = new TextEncoder();
            const data = encoder.encode(`global:${instructionName}`);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = new Uint8Array(hashBuffer);
            return hashArray.slice(0, 8);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ RPC —Å –∫–æ—Ä–æ—Ç–∫–∏–º timeout
            for (let i = 0; i < RPC_URLS.length; i++) {
                try {
                    const rpcName = RPC_URLS[i].replace('https://', '').split('/')[0];
                    console.log(`üîó RPC ${i + 1}/${RPC_URLS.length}: ${rpcName}`);
                    connection = new window.solanaWeb3.Connection(RPC_URLS[i], 'confirmed');
                    
                    // –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (5 —Å–µ–∫)
                    await Promise.race([
                        connection.getVersion(),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout')), 5000)
                        )
                    ]);
                    
                    currentRpcIndex = i;
                    console.log(`‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ —á–µ—Ä–µ–∑: ${rpcName}`);
                    break;
                } catch (err) {
                    console.log(`‚ùå ${RPC_URLS[i].split('/')[2]} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`);
                    if (i === RPC_URLS.length - 1) {
                        console.warn('‚ö†Ô∏è –í—Å–µ RPC –º–µ–¥–ª–µ–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É—é –ø–µ—Ä–≤—ã–π...');
                        connection = new window.solanaWeb3.Connection(RPC_URLS[0], 'confirmed');
                        currentRpcIndex = 0;
                    }
                }
            }
        }

        // –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫
        window.disconnectWallet = async function() {
            try {
                if (wallet && wallet.disconnect) {
                    await wallet.disconnect();
                }
                
                // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                wallet = null;
                petPubkey = null;
                realPetData = null;
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º real-time updates
                stopRealtimeUpdates();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º UI
                document.getElementById('connectBtn').style.display = 'block';
                document.getElementById('walletAddress').style.display = 'none';
                document.getElementById('createScreen').style.display = 'none';
                document.getElementById('gameScreen').style.display = 'none';
                
                showNotification('üëã Wallet disconnected');
                console.log('‚úÖ –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω');
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:', err);
                showNotification('‚ùå Error disconnecting wallet');
            }
        }
        
        window.connectWallet = async function() {
            try {
                if (!window.solana || !window.solana.isPhantom) {
                    showNotification('‚ùå Please install Phantom Wallet!');
                    window.open('https://phantom.app/', '_blank');
                    return;
                }

                const resp = await window.solana.connect();
                wallet = window.solana;
                
                const address = resp.publicKey.toString();
                const short = address.slice(0, 4) + '...' + address.slice(-4);
                
                document.getElementById('connectBtn').textContent = short;
                document.getElementById('walletAddress').style.display = 'block';
                
                // üéØ –û–±–Ω–æ–≤–∏—Ç—å TAMA –±–∞–ª–∞–Ω—Å
                await updateTamaBalance();
                
                showNotification('‚úÖ Wallet connected!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
                updateReferralLink();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å Entry Fee
                checkSavedEntryFee();
                
                // üíæ –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                loadGameState();
                
                // ‚ù§Ô∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∂–∏–∑–Ω–∏
                loadLivesFromStorage();
                
                // üí∞ –ù–∞—á–∏—Å–ª—è–µ–º offline –Ω–∞–≥—Ä–∞–¥—ã
                claimOfflineRewards();
                
                await checkExistingPet();
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', err);
                showNotification('‚ùå Error connecting wallet');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
        var isCheckingPet = false; // –§–ª–∞–≥ –ø—Ä–æ—Ç–∏–≤ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è
        var currentRpcIndex = 0;
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        async function checkProgramExists() {
            try {
                const programInfo = await connection.getAccountInfo(new window.solanaWeb3.PublicKey(PROGRAM_ID));
                if (!programInfo) {
                    console.error('‚ùå –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω! Program ID:', PROGRAM_ID);
                    showNotification('‚ùå Contract not found! Check deployment.');
                    return false;
                }
                console.log('‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞–π–¥–µ–Ω:', PROGRAM_ID);
                return true;
            } catch (err) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:', err);
                return false;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å Entry Fee
        function checkSavedEntryFee() {
            if (!wallet) return false;
            
            const walletKey = wallet.publicKey.toString();
            const savedEntryFee = localStorage.getItem(`entryFeePaid_${walletKey}`);
            const timestamp = localStorage.getItem(`entryFeeTimestamp_${walletKey}`);
            
            if (savedEntryFee === 'true') {
                entryFeePaid = true;
                console.log(`‚úÖ Entry Fee –±—ã–ª –æ–ø–ª–∞—á–µ–Ω —Ä–∞–Ω–µ–µ (${new Date(parseInt(timestamp)).toLocaleString()})`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º recovery –∫–Ω–æ–ø–∫—É –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–æ–∑–¥–∞–Ω–∏—è
                const recoveryBtn = document.getElementById('recoveryBtn');
                if (recoveryBtn) recoveryBtn.style.display = 'block';
                
                return true;
            }
            return false;
        }
        
        // Recovery —Ñ—É–Ω–∫—Ü–∏—è - —Å–æ–∑–¥–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞ –µ—Å–ª–∏ Entry Fee —É–∂–µ –æ–ø–ª–∞—á–µ–Ω
        window.recoverEntryFee = async function() {
            if (!wallet) {
                showNotification('‚ùå Connect your wallet!');
                return;
            }
            
            const walletKey = wallet.publicKey.toString();
            const savedEntryFee = localStorage.getItem(`entryFeePaid_${walletKey}`);
            
            if (savedEntryFee === 'true') {
                entryFeePaid = true;
                showNotification('‚úÖ Entry Fee confirmed! Creating pet...');
                createPet();
            } else {
                showNotification('‚ùå Entry Fee not found. Pay entry first.');
            }
        }
        
        // Manual Refresh - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏—Ç–æ–º—Ü–∞
        async function manualRefresh() {
            if (!wallet) {
                showNotification('‚ùå Connect your wallet!');
                return;
            }
            
            showNotification('üîÑ Checking pet...');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
            isCheckingPet = false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞
            await checkExistingPet();
        }
        
        async function getAccountInfoWithRetry(pubkey, maxRetries = 12) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const rpcName = RPC_URLS[currentRpcIndex].replace('https://', '').split('/')[0];
                    console.log(`üì° –ü–æ–ø—ã—Ç–∫–∞ ${i + 1}/${maxRetries} | RPC: ${rpcName}`);
                    
                    // –£–º–µ–Ω—å—à–∞–µ–º timeout –¥–æ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
                    const timeout = 5000;
                    
                    const accountInfo = await Promise.race([
                        connection.getAccountInfo(pubkey),
                        new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout')), timeout)
                        )
                    ]);
                    
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã!');
                    return accountInfo;
                } catch (err) {
                    console.log(`‚ùå –ü–æ–ø—ã—Ç–∫–∞ ${i + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, err.message);
                    
                    if (i < maxRetries - 1) {
                        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π RPC
                        currentRpcIndex = (currentRpcIndex + 1) % RPC_URLS.length;
                        const rpcName = RPC_URLS[currentRpcIndex].replace('https://', '').split('/')[0];
                        console.log(`üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ RPC ${currentRpcIndex + 1}/${RPC_URLS.length}: ${rpcName}`);
                        connection = new window.solanaWeb3.Connection(RPC_URLS[currentRpcIndex], 'confirmed');
                        
                        // –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º
                        await new Promise(resolve => setTimeout(resolve, 300));
                    } else {
                        // –ï—Å–ª–∏ –≤—Å–µ RPC –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç - –≤–æ–∑–º–æ–∂–Ω–æ –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                        console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –í–æ–∑–º–æ–∂–Ω–æ, –∞–∫–∫–∞—É–Ω—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.');
                        return null;
                    }
                }
            }
            return null;
        }
        
        async function checkExistingPet() {
            if (isCheckingPet) {
                console.log('‚è≥ –£–∂–µ –ø—Ä–æ–≤–µ—Ä—è—é –ø–∏—Ç–æ–º—Ü–∞, –ø—Ä–æ–ø—É—Å–∫–∞—é...');
                return;
            }
            
            isCheckingPet = true;
            
            try {
                console.log('üîç –ü—Ä–æ–≤–µ—Ä—è—é –ø–∏—Ç–æ–º—Ü–∞...');
                showNotification('‚è≥ Checking pet... Trying 4 different RPCs...');
                
                const [petPda] = await getPetPda(wallet.publicKey);
                petPubkey = petPda;
                console.log('üìç Pet PDA:', petPda.toString());
                
                // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å retry
                const accountInfo = await getAccountInfoWithRetry(petPda);
                console.log('üì¶ Account Info:', accountInfo);
                
                if (accountInfo && accountInfo.data) {
                    console.log('‚úÖ –ü–∏—Ç–æ–º–µ—Ü –Ω–∞–π–¥–µ–Ω! –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
                    const pet = deserializePet(accountInfo.data);
                    realPetData = pet;
                    console.log('üê£ Pet data:', pet);
                    console.log('üíÄ Pet is alive:', pet.isAlive);
                    console.log('‚ù§Ô∏è Pet health:', pet.health);
                    
                    document.getElementById('createScreen').style.display = 'none';
                    document.getElementById('gameScreen').style.display = 'block';
                    updateDisplay(pet);
                    
                    document.getElementById('petAccountLink').href = 
                        `https://explorer.solana.com/address/${petPda.toString()}?cluster=devnet`;
                    
                    startRealtimeUpdates();
                    
                    showNotification('üéâ Your pet found!');
                } else {
                    console.log('‚ùå –ü–∏—Ç–æ–º–µ—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞—é —ç–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è');
                    document.getElementById('createScreen').style.display = 'block';
                    document.getElementById('gameScreen').style.display = 'none';
                }
            } catch (err) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∏—Ç–æ–º—Ü–∞:', err);
                
                // –£–ª—É—á—à–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è RPC –æ—à–∏–±–æ–∫
                if (err.message.includes('Timeout') || err.message.includes('RPC')) {
                    showNotification('‚ö†Ô∏è Devnet network issues. Try refreshing or creating pet.');
                } else {
                    showNotification('‚ùå Error: ' + err.message);
                }
                
                document.getElementById('createScreen').style.display = 'block';
                document.getElementById('gameScreen').style.display = 'none';
            } finally {
                isCheckingPet = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å PDA –ø–∏—Ç–æ–º—Ü–∞
        async function getPetPda(ownerPubkey) {
            const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
            return await window.solanaWeb3.PublicKey.findProgramAddress(
                [stringToBytes('pet'), ownerPubkey.toBytes()],
                programId
            );
        }

        // üéØ –ü–æ–ª—É—á–∏—Ç—å PDA –¥–ª—è TAMA Token Mint
        async function getTamaMintPda() {
            const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
            return await window.solanaWeb3.PublicKey.findProgramAddress(
                [stringToBytes('tama_mint')],
                programId
            );
        }

        // üéØ –ü–æ–ª—É—á–∏—Ç—å TAMA Token Account –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getTamaTokenAccount(wallet) {
            try {
                const [tamaMint] = await getTamaMintPda();
                const [address] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [wallet.toBytes(), new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID).toBytes(), tamaMint.toBytes()],
                    new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL')
                );
                return address;
            } catch (error) {
                console.log('TAMA Token Account –Ω–µ –Ω–∞–π–¥–µ–Ω:', error.message);
                return null;
            }
        }

        // üéØ –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å TAMA —Ç–æ–∫–µ–Ω–æ–≤
        async function getTamaBalance(wallet) {
            try {
                const tamaAccount = await getTamaTokenAccount(wallet);
                if (!tamaAccount) {
                    console.log('TAMA –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return 0;
                }
                const accountInfo = await connection.getTokenAccountBalance(tamaAccount);
                return accountInfo.value.uiAmount || 0;
            } catch (error) {
                console.log('TAMA –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', error.message);
                return 0;
            }
        }

        // üéØ –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ TAMA –±–∞–ª–∞–Ω—Å–∞
        async function updateTamaBalance() {
            if (!wallet || !wallet.publicKey) return;
            
            try {
                const balance = await getTamaBalance(wallet.publicKey);
                const tamaElement = document.getElementById('tamaAmount');
                if (tamaElement) {
                    tamaElement.textContent = balance.toFixed(2);
                }
                console.log('üéØ TAMA –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω:', balance);
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è TAMA –±–∞–ª–∞–Ω—Å–∞:', error);
                const tamaElement = document.getElementById('tamaAmount');
                if (tamaElement) {
                    tamaElement.textContent = '0';
                }
            }
        }

        // üé® –°–æ–∑–¥–∞—Ç—å NFT –ø–∏—Ç–æ–º—Ü–∞ –∑–∞ TAMA
        window.createNFTWithTAMA = async function() {
            if (!wallet || !wallet.publicKey) return;
            
            showNotification('üé® NFT for TAMA temporarily disabled! Use NFT for SOL.');
            return;
            
            try {
                showNotification('üé® Creating NFT for TAMA...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å TAMA
                const tamaBalance = await getTamaBalance(wallet.publicKey);
                if (tamaBalance < 10) {
                    showNotification('‚ùå Insufficient TAMA! Need: 10, you have: ' + tamaBalance);
                    return;
                }
                
                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                const [petPubkey] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('pet'), wallet.publicKey.toBytes()],
                    programId
                );
                
                // –ü–æ–ª—É—á–∞–µ–º NFT Mint PDA
                const [nftMint] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('nft_mint'), wallet.publicKey.toBytes()],
                    programId
                );
                
                // –ü–æ–ª—É—á–∞–µ–º NFT Token Account
                const [nftTokenAccount] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [wallet.publicKey.toBytes(), new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID).toBytes(), nftMint.toBytes()],
                    new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL')
                );
                
                // –ü–æ–ª—É—á–∞–µ–º TAMA Token Account (–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
                // const [tamaMint] = await getTamaMintPda();
                // const tamaTokenAccount = await getTamaTokenAccount(wallet.publicKey);
                
                // –ü–æ–ª—É—á–∞–µ–º Metadata PDA
                const [metadata] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('metadata'), nftMint.toBytes()],
                    programId
                );
                
                const name = `Tamagotchi #${Date.now()}`;
                const uri = `https://api.tamagotchi.com/metadata/${nftMint.toString()}`;
                
                // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Anchor discriminator –¥–ª—è create_pet_nft
                const data = new Uint8Array([108, 44, 10, 111, 6, 143, 227, 102]); // create_pet_nft instruction
                
                const nameBytes = new TextEncoder().encode(name);
                const uriBytes = new TextEncoder().encode(uri);
                
                const fullData = new Uint8Array([
                    ...data,
                    nameBytes.length,
                    ...nameBytes,
                    uriBytes.length,
                    ...uriBytes
                ]);
                
                const nftKeys = [
                    { pubkey: petPubkey, isSigner: false, isWritable: true },
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                    { pubkey: nftMint, isSigner: false, isWritable: true },
                    { pubkey: nftTokenAccount, isSigner: false, isWritable: true },
                    { pubkey: metadata, isSigner: false, isWritable: true },
                    { pubkey: new window.solanaWeb3.PublicKey('11111111111111111111111111111111'), isSigner: false, isWritable: false }, // token_metadata_program
                    { pubkey: new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID), isSigner: false, isWritable: false },
                    { pubkey: new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL'), isSigner: false, isWritable: false }, // associated_token_program
                    { pubkey: window.solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                    { pubkey: window.solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
                ];
                
                const instruction = new window.solanaWeb3.TransactionInstruction({
                    keys: nftKeys,
                    programId,
                    data: fullData,
                });
                
                const transaction = new window.solanaWeb3.Transaction().add(instruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                
                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature, 'confirmed');
                
                showNotification('üéâ NFT created for TAMA! 10 TAMA burned!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await checkExistingPet();
                await updateTamaBalance();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è NFT –∑–∞ TAMA:', error);
                showNotification('‚ùå Error: ' + error.message);
            }
        }

        // üí∞ –°–æ–∑–¥–∞—Ç—å NFT –ø–∏—Ç–æ–º—Ü–∞ –∑–∞ SOL
        window.createNFTWithSOL = async function() {
            if (!wallet || !wallet.publicKey) return;
            
            try {
                showNotification('üí∞ Creating NFT for SOL...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å SOL
                const solBalance = await connection.getBalance(wallet.publicKey);
                const solAmount = solBalance / window.solanaWeb3.LAMPORTS_PER_SOL;
                
                if (solAmount < 0.01) {
                    showNotification('‚ùå Insufficient SOL! Need: 0.01, you have: ' + solAmount.toFixed(4));
                    return;
                }
                
                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                const [petPubkey] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('pet'), wallet.publicKey.toBytes()],
                    programId
                );
                const treasury = new window.solanaWeb3.PublicKey(TREASURY_WALLET);
                
                // –ü–æ–ª—É—á–∞–µ–º NFT Mint PDA
                const [nftMint] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('nft_mint'), wallet.publicKey.toBytes()],
                    programId
                );
                
                // –ü–æ–ª—É—á–∞–µ–º NFT Token Account
                const [nftTokenAccount] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [wallet.publicKey.toBytes(), new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID).toBytes(), nftMint.toBytes()],
                    new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL')
                );
                
                // –ü–æ–ª—É—á–∞–µ–º Metadata PDA
                const [metadata] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('metadata'), nftMint.toBytes()],
                    programId
                );
                
                const name = `Tamagotchi #${Date.now()}`;
                const uri = `https://api.tamagotchi.com/metadata/${nftMint.toString()}`;
                
                // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Anchor discriminator –¥–ª—è create_pet_nft_sol
                const data = new Uint8Array([119, 155, 58, 202, 61, 173, 49, 134]); // create_pet_nft_sol instruction
                
                const nameBytes = new TextEncoder().encode(name);
                const uriBytes = new TextEncoder().encode(uri);
                
                const fullData = new Uint8Array([
                    ...data,
                    nameBytes.length,
                    ...nameBytes,
                    uriBytes.length,
                    ...uriBytes
                ]);
                
                const solNftKeys = [
                    { pubkey: petPubkey, isSigner: false, isWritable: true },
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                    { pubkey: treasury, isSigner: false, isWritable: true },
                    { pubkey: nftMint, isSigner: false, isWritable: true },
                    { pubkey: nftTokenAccount, isSigner: false, isWritable: true },
                    { pubkey: metadata, isSigner: false, isWritable: true },
                    { pubkey: new window.solanaWeb3.PublicKey('11111111111111111111111111111111'), isSigner: false, isWritable: false }, // token_metadata_program
                    { pubkey: new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID), isSigner: false, isWritable: false },
                    { pubkey: new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL'), isSigner: false, isWritable: false }, // associated_token_program
                    { pubkey: window.solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                    { pubkey: window.solanaWeb3.SYSVAR_RENT_PUBKEY, isSigner: false, isWritable: false },
                ];
                
                const instruction = new window.solanaWeb3.TransactionInstruction({
                    keys: solNftKeys,
                    programId,
                    data: fullData,
                });
                
                const transaction = new window.solanaWeb3.Transaction().add(instruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                
                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature, 'confirmed');
                
                showNotification('üéâ NFT created for SOL! 0.01 SOL sent to treasury!');
                
                // ‚ù§Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º 3 –∂–∏–∑–Ω–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
                petLives = 3;
                deathCount = 0;
                saveLivesToStorage();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await new Promise(resolve => setTimeout(resolve, 1000));
                await checkExistingPet();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è NFT –∑–∞ SOL:', error);
                showNotification('‚ùå Error: ' + error.message);
            }
        }

        // –°–æ–∑–¥–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞
        window.createPet = async function() {
            if (!wallet) return;
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
                const programExists = await checkProgramExists();
                if (!programExists) {
                    showNotification('‚ùå Contract not found! Check Solana Playground deployment.');
                    return;
                }
                
                showNotification('üê£ Creating pet...');
                const createBtn = document.getElementById('createPetBtn');
                if (createBtn) createBtn.disabled = true;

                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                const [petPda] = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [stringToBytes('pet'), wallet.publicKey.toBytes()],
                    programId
                );

                // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Anchor discriminator –¥–ª—è create_pet
                const data = new Uint8Array([31, 116, 155, 96, 251, 101, 128, 164]); // create_pet instruction

                const createKeys = [
                    { pubkey: petPda, isSigner: false, isWritable: true },
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                    { pubkey: window.solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                ];

                const instruction = new window.solanaWeb3.TransactionInstruction({
                    keys: createKeys,
                    programId,
                    data,
                });

                const transaction = new window.solanaWeb3.Transaction().add(instruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                
                await connection.confirmTransaction(signature, 'confirmed');
                
                showNotification('‚úÖ Pet created!');
                
                // ‚ù§Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º 3 –∂–∏–∑–Ω–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞
                petLives = 3;
                deathCount = 0;
                saveLivesToStorage();
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                await checkExistingPet();
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è:', err);
                
                // –ï—Å–ª–∏ –ø–∏—Ç–æ–º–µ—Ü —É–∂–µ —Å–æ–∑–¥–∞–Ω - –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
                if (err.message && (err.message.includes('already been processed') || err.message.includes('already in use'))) {
                    console.log('‚úÖ –ü–∏—Ç–æ–º–µ—Ü —É–∂–µ —Å–æ–∑–¥–∞–Ω!');
                    showNotification('‚úÖ Pet already exists! Loading...');
                    
                    // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞
                    setTimeout(async () => {
                        await checkExistingPet();
                    }, 2000);
                } else {
                    showNotification('‚ùå Error: ' + err.message);
                    const createBtn = document.getElementById('createPetBtn');
                    if (createBtn) createBtn.disabled = false;
                }
            }
        }

        // Deserialize Pet
        function deserializePet(data) {
            let offset = 8; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º discriminator
            
            // ‚úÖ –ß–∏—Ç–∞–µ–º –≤—Å–µ 4 Pubkey –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Pet
            const owner = new window.solanaWeb3.PublicKey(data.slice(offset, offset + 32));
            offset += 32;
            
            const mint = new window.solanaWeb3.PublicKey(data.slice(offset, offset + 32));
            offset += 32;
            
            const nftMint = new window.solanaWeb3.PublicKey(data.slice(offset, offset + 32));
            offset += 32;
            
            const metadata = new window.solanaWeb3.PublicKey(data.slice(offset, offset + 32));
            offset += 32;
            
            const dna = readU64LE(data, offset);
            offset += 8;
            
            const petId = readU32LE(data, offset);
            offset += 4;
            
            const species = data[offset];
            offset += 1;
            
            const accessory = data[offset];
            offset += 1;
            
            const background = data[offset];
            offset += 1;
            
            const rarity = data[offset];
            offset += 1;
            
            const level = data[offset];
            offset += 1;
            
            const experience = readU16LE(data, offset);
            offset += 2;
            
            const health = data[offset];
            offset += 1;
            
            const hunger = data[offset];
            offset += 1;
            
            const happiness = data[offset];
            offset += 1;
            
            const energy = data[offset];
            offset += 1;
            
            const age = readU32LE(data, offset);
            offset += 4;
            
            const birthTime = readI64LE(data, offset);
            offset += 8;
            
            const lastActionTime = readI64LE(data, offset);
            offset += 8;
            
            const lastDecayTime = readI64LE(data, offset);
            offset += 8;
            
            // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
            const totalTokensBurned = readU64LE(data, offset);
            offset += 8;
            
            const actionsCount = readU32LE(data, offset);
            offset += 4;
            
            const isAlive = data[offset] !== 0;
            offset += 1;
            
            const lives = data[offset] || 3;
            offset += 1;
            
            const bump = data[offset];
            offset += 1;
            
            return {
                owner, dna, petId, species, accessory, background, rarity, level,
                experience, health, hunger, happiness, energy, age, 
                birthTime, lastActionTime, lastDecayTime, actionsCount, isAlive,
                lives, totalTokensBurned
            };
        }

        function readU32LE(buffer, offset) {
            return buffer[offset] + (buffer[offset + 1] << 8) + 
                   (buffer[offset + 2] << 16) + (buffer[offset + 3] << 24);
        }

        function readU16LE(buffer, offset) {
            return buffer[offset] + (buffer[offset + 1] << 8);
        }

        function readU64LE(buffer, offset) {
            const low = readU32LE(buffer, offset);
            const high = readU32LE(buffer, offset + 4);
            return low + high * 4294967296;
        }

        function readI64LE(buffer, offset) {
            const low = readU32LE(buffer, offset);
            const high = readU32LE(buffer, offset + 4);
            return low + high * 4294967296;
        }


        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        function updateDisplay(pet) {
            const species = SPECIES_EMOJI[pet.species] || 'üê£';
            const petSpriteEl = document.getElementById('petSprite');
            const petDisplayEl = document.getElementById('petDisplay');
            
            // üé® –ü–æ–∫–∞–∑—ã–≤–∞–µ–º emoji —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
            if (petSpriteEl) {
                petSpriteEl.textContent = pet.isAlive ? species : 'üíÄ';
                
                // –î–æ–±–∞–≤–ª—è–µ–º shake –µ—Å–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
                if (pet.health < 30) {
                    petSpriteEl.classList.add('health-critical');
                } else {
                    petSpriteEl.classList.remove('health-critical');
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å —Ä–µ–¥–∫–æ—Å—Ç–∏ –¥–ª—è —Å–≤–µ—á–µ–Ω–∏—è
            if (petDisplayEl) {
                petDisplayEl.className = 'pet-display rarity-' + pet.rarity;
            }
            
            const petNameEl = document.getElementById('petName');
            if (petNameEl) {
                petNameEl.textContent = pet.isAlive ? 
                    `–ü–∏—Ç–æ–º–µ—Ü #${pet.petId}` : `üíÄ –ü–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤ #${pet.petId}`;
            }
            
            const petLevelEl = document.getElementById('petLevel');
            if (petLevelEl) {
                petLevelEl.textContent = `–£—Ä–æ–≤–µ–Ω—å ${pet.level}`;
            }
            
            // Experience bar
            const expToNext = getExpToNextLevel(pet.level);
            const expProgress = (pet.experience / expToNext) * 100;
            const expBarEl = document.getElementById('expBar');
            const expTextEl = document.getElementById('expText');
            if (expBarEl) expBarEl.style.width = Math.min(expProgress, 100) + '%';
            if (expTextEl) expTextEl.textContent = `EXP: ${pet.experience} / ${expToNext}`;
            
            updateStatBar('healthBar', pet.health);
            updateStatBar('hungerBar', pet.hunger);
            updateStatBar('happinessBar', pet.happiness);
            updateStatBar('energyBar', pet.energy);
            
            const petIdEl = document.getElementById('petId');
            if (petIdEl) petIdEl.textContent = `#${pet.petId}`;
            
            const petDnaEl = document.getElementById('petDna');
            if (petDnaEl) petDnaEl.textContent = pet.dna.toString().slice(0, 10) + '...';
            
            const rarityName = RARITY_NAMES[pet.rarity] || 'Common';
            const rarityStars = RARITY_STARS[pet.rarity] || '‚≠ê';
            const petRarityEl = document.getElementById('petRarity');
            if (petRarityEl) petRarityEl.textContent = `${rarityName} ${rarityStars}`;
            
            const totalActionsEl = document.getElementById('totalActions');
            if (totalActionsEl) totalActionsEl.textContent = pet.actionsCount;
            
            const totalBurnedEl = document.getElementById('totalBurned');
            if (totalBurnedEl) totalBurnedEl.textContent = (pet.totalTokensBurned / 1_000_000_000).toFixed(1);
            
            // –í–æ–∑—Ä–∞—Å—Ç
            const ageMinutes = Math.floor(pet.age / 60);
            const ageHours = Math.floor(ageMinutes / 60);
            const ageText = ageHours > 0 ? 
                `${ageHours}—á ${ageMinutes % 60}–º` : `${ageMinutes}–º`;
            const petAgeEl = document.getElementById('petAge');
            if (petAgeEl) petAgeEl.textContent = ageText;
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–π
            updateLivesDisplay();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è
            const resurrectionPanel = document.getElementById('resurrectionPanel');
            const actionsDiv = document.querySelector('.actions');
            
            if (!pet.isAlive) {
                // –ü–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è
                resurrectionPanel.style.display = 'block';
                actionsDiv.style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –∂–∏–∑–Ω–∏
                const freeBtn = document.getElementById('resurrectFreeBtn');
                if (freeBtn) {
                    freeBtn.style.display = petLives > 0 ? 'block' : 'none';
                }
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è
                document.getElementById('feedBtn').disabled = true;
                document.getElementById('playBtn').disabled = true;
                document.getElementById('healBtn').disabled = true;
                document.getElementById('restBtn').disabled = true;
                document.getElementById('autoClickerBtn').disabled = true;
            } else {
                // –ü–∏—Ç–æ–º–µ—Ü –∂–∏–≤ - —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è
                resurrectionPanel.style.display = 'none';
                actionsDiv.style.display = 'grid';
                
                // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è
                const feedBtn = document.getElementById('feedBtn');
                const playBtn = document.getElementById('playBtn');
                const healBtn = document.getElementById('healBtn');
                const restBtn = document.getElementById('restBtn');
                
                if (feedBtn) feedBtn.disabled = false;
                if (playBtn) playBtn.disabled = false;
                if (healBtn) healBtn.disabled = false;
                if (restBtn) restBtn.disabled = false;
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å TAMA –±–∞–ª–∞–Ω—Å
            updateTokenBalance();
        }

        function getExpToNextLevel(level) {
            const thresholds = [100, 300, 600, 1000];
            return thresholds[level - 1] || 1000;
        }

        function updateStatBar(id, value) {
            const bar = document.getElementById(id);
            bar.style.width = value + '%';
            bar.textContent = value + '%';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º data-value –¥–ª—è —Ü–≤–µ—Ç–∞
            const rangeValue = Math.floor(value / 10);
            bar.setAttribute('data-value', rangeValue);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É–ª—å—Å–∞—Ü–∏—é –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ
            const stat = bar.parentElement.parentElement;
            if (value < 30) {
                stat.classList.add('stat-critical');
            } else {
                stat.classList.remove('stat-critical');
            }
        }

        // ============================================================================
        // üî• –†–ï–ê–õ–¨–ù–û–ï –í–†–ï–ú–Ø DECAY
        // ============================================================================

        function calculateVirtualStats(pet) {
            if (!pet) return null;
            
            const now = Date.now() / 1000;
            const timePassed = now - pet.lastDecayTime;
            
            if (timePassed < 60) {
                return {
                    hunger: pet.hunger,
                    thirst: pet.thirst || 100, // Default to 100 if not set
                    happiness: pet.happiness,
                    energy: pet.energy,
                    health: pet.health,
                    isAlive: pet.isAlive,
                    timePassed: timePassed
                };
            }
            
            const decayCycles = Math.floor(timePassed / 60);
            
            // üí° –ù–û–í–´–ô DECAY: -1 –∑–∞ –º–∏–Ω—É—Ç—É –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç–æ–≤
            let virtualHunger = Math.max(0, pet.hunger - decayCycles);
            let virtualThirst = Math.max(0, (pet.thirst || 100) - decayCycles);
            let virtualHappiness = Math.max(0, pet.happiness - decayCycles);
            let virtualEnergy = Math.max(0, pet.energy - decayCycles);
            let virtualHealth = pet.health;
            
            // –ï—Å–ª–∏ –õ–Æ–ë–û–ô stat = 0, health –ø–∞–¥–∞–µ—Ç -3 –∑–∞ –º–∏–Ω—É—Ç—É
            if (virtualHunger === 0 || virtualThirst === 0 || virtualHappiness === 0 || virtualEnergy === 0) {
                virtualHealth = Math.max(0, virtualHealth - (decayCycles * 3));
            }
            
            const virtualAlive = virtualHealth > 0;
            
            return {
                hunger: virtualHunger,
                thirst: virtualThirst,
                happiness: virtualHappiness,
                energy: virtualEnergy,
                health: virtualHealth,
                isAlive: virtualAlive,
                timePassed: timePassed
            };
        }

        function predictDeath(pet) {
            if (!pet) return null;
            
            let virtualPet = { ...pet };
            let minutes = 0;
            
            while (virtualPet.health > 0 && minutes < 10000) {
                minutes++;
                
                // üí° –£–õ–£–ß–®–ï–ù–ù–´–ô DECAY: –†–∞–∑–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —É–º–µ–Ω—å—à–µ–Ω–∏—è
                // Hunger –ø–∞–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ—Ö (–ø–∏—Ç–æ–º–µ—Ü –≥–æ–ª–æ–¥–Ω—ã–π!)
                virtualPet.hunger = Math.max(0, virtualPet.hunger - 1.2);
                
                // Energy –ø–∞–¥–∞–µ—Ç —Å—Ä–µ–¥–Ω–µ (—É—Å—Ç–∞–µ—Ç –æ—Ç –∏–≥—Ä)
                virtualPet.energy = Math.max(0, virtualPet.energy - 0.8);
                
                // Happiness –ø–∞–¥–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–æ–ª—å—à–µ –¥–µ—Ä–∂–∏—Ç—Å—è)
                virtualPet.happiness = Math.max(0, virtualPet.happiness - 0.5);
                
                // –ï—Å–ª–∏ –õ–Æ–ë–û–ô stat < 20, health –ø–∞–¥–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ
                const criticalStats = virtualPet.hunger < 20 || virtualPet.happiness < 20 || virtualPet.energy < 20;
                if (criticalStats) {
                    virtualPet.health = Math.max(0, virtualPet.health - 2);
                }
                
                // –ï—Å–ª–∏ stat = 0, health –ø–∞–¥–∞–µ—Ç –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ
                if (virtualPet.hunger === 0 || virtualPet.happiness === 0 || virtualPet.energy === 0) {
                    virtualPet.health = Math.max(0, virtualPet.health - 5);
                }
            }
            
            return minutes;
        }

        function getRecommendations(virtualStats) {
            const recommendations = [];
            
            if (virtualStats.hunger < 70) {
                recommendations.push({
                    action: 'üçñ –ö–æ—Ä–º–∏—Ç—å',
                    urgency: virtualStats.hunger < 30 ? 'critical' : 'medium',
                    cost: '5 TAMA'
                });
            }
            
            if (virtualStats.happiness < 70) {
                recommendations.push({
                    action: 'üéÆ –ò–≥—Ä–∞—Ç—å',
                    urgency: virtualStats.happiness < 30 ? 'critical' : 'medium',
                    cost: '3 TAMA'
                });
            }
            
            if (virtualStats.energy < 60) {
                recommendations.push({
                    action: 'üò¥ –û—Ç–¥–æ—Ö–Ω—É—Ç—å',
                    urgency: virtualStats.energy < 30 ? 'high' : 'low',
                    cost: '2 TAMA'
                });
            }
            
            if (virtualStats.health < 50) {
                recommendations.push({
                    action: 'üíä –õ–µ—á–∏—Ç—å',
                    urgency: 'critical',
                    cost: '8 TAMA'
                });
            }
            
            return recommendations;
        }

        function updateRealtimeUI() {
            if (!realPetData) return;
            
            const virtualStats = calculateVirtualStats(realPetData);
            if (!virtualStats) return;
            
            updateStatBar('hungerBar', virtualStats.hunger);
            updateStatBar('happinessBar', virtualStats.happiness);
            updateStatBar('energyBar', virtualStats.energy);
            updateStatBar('healthBar', virtualStats.health);
            
            if (!virtualStats.isAlive && realPetData.isAlive) {
                document.getElementById('petSprite').textContent = 'üíÄ';
                document.getElementById('petName').textContent = `üíÄ –ü–∏—Ç–æ–º–µ—Ü —É–º–µ—Ä #${realPetData.petId}`;
                
                // üíÄ –ü–û–ö–ê–ó–´–í–ê–ï–ú –ü–ê–ù–ï–õ–¨ –í–û–°–ö–†–ï–®–ï–ù–ò–Ø!
                const resurrectionPanel = document.getElementById('resurrectionPanel');
                const actionsDiv = document.querySelector('.actions');
                
                if (resurrectionPanel) resurrectionPanel.style.display = 'block';
                if (actionsDiv) actionsDiv.style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å –∂–∏–∑–Ω–∏
                const freeBtn = document.getElementById('resurrectFreeBtn');
                if (freeBtn) {
                    freeBtn.style.display = petLives > 0 ? 'block' : 'none';
                }
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                const feedBtn = document.getElementById('feedBtn');
                const playBtn = document.getElementById('playBtn');
                const healBtn = document.getElementById('healBtn');
                const restBtn = document.getElementById('restBtn');
                const autoClickerBtn = document.getElementById('autoClickerBtn');
                
                if (feedBtn) feedBtn.disabled = true;
                if (playBtn) playBtn.disabled = true;
                if (healBtn) healBtn.disabled = true;
                if (restBtn) restBtn.disabled = true;
                if (autoClickerBtn) autoClickerBtn.disabled = true;
            }
            
            if (virtualStats.isAlive) {
                const deathMinutes = predictDeath(virtualStats);
                const deathPredEl = document.getElementById('deathPrediction');
                
                if (deathMinutes < 300) {
                    const hours = Math.floor(deathMinutes / 60);
                    const mins = deathMinutes % 60;
                    deathPredEl.textContent = `üíÄ –£–º—Ä—ë—Ç —á–µ—Ä–µ–∑: ${hours > 0 ? hours + '—á ' : ''}${mins}–º`;
                    deathPredEl.style.display = 'block';
                } else {
                    deathPredEl.style.display = 'none';
                }
            } else {
                document.getElementById('deathPrediction').textContent = 'üíÄ –ü–∏—Ç–æ–º–µ—Ü –º–µ—Ä—Ç–≤';
                document.getElementById('deathPrediction').style.display = 'block';
            }
            
            const recommendations = getRecommendations(virtualStats);
            const recEl = document.getElementById('recommendations');
            const recListEl = document.getElementById('recommendationsList');
            
            if (recommendations.length > 0) {
                recEl.style.display = 'block';
                
                let html = '';
                recommendations.forEach(rec => {
                    const urgencyColor = 
                        rec.urgency === 'critical' ? '#d32f2f' :
                        rec.urgency === 'high' ? '#f57c00' :
                        rec.urgency === 'medium' ? '#fbc02d' : '#689f38';
                    
                    html += `<div class="recommendation-item" style="color: ${urgencyColor};">
                        ${rec.action} (${rec.cost})
                    </div>`;
                });
                
                recListEl.innerHTML = html;
            } else {
                recEl.style.display = 'none';
            }
            
            // üí∞ –û–±–Ω–æ–≤–ª—è–µ–º offline –Ω–∞–≥—Ä–∞–¥—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            if (autoClickers > 0) {
                const offlineReward = calculateOfflineRewards();
                const offlineEl = document.getElementById('offlineReward');
                if (offlineEl) {
                    offlineEl.textContent = offlineReward > 0 ? offlineReward.toLocaleString() : '0';
                }
            }
        }

        function startRealtimeUpdates() {
            if (realtimeUpdateInterval) {
                clearInterval(realtimeUpdateInterval);
            }
            
            realtimeUpdateInterval = setInterval(updateRealtimeUI, 1000);
            updateRealtimeUI();
            
            console.log('‚úÖ –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø—É—â–µ–Ω–æ!');
        }

        function stopRealtimeUpdates() {
            if (realtimeUpdateInterval) {
                clearInterval(realtimeUpdateInterval);
                realtimeUpdateInterval = null;
            }
        }

        // ============================================================================
        // –î–ï–ô–°–¢–í–ò–Ø
        // ============================================================================

        var isActionInProgress = false; // üîí –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö –∫–ª–∏–∫–æ–≤

        window.feedPet = async function() {
            if (isActionInProgress) {
                showNotification('‚è≥ Please wait, action in progress...');
                return;
            }
            await performAction('feed_pet', 'üçñ –ö–æ—Ä–º–ª—é...', '‚úÖ –ü–æ–∫–æ—Ä–º–ª–µ–Ω!', 5_000_000_000);
            addToHistory('üçñ –ü–æ–∫–æ—Ä–º–∏–ª');
        }

        window.playWithPet = async function() {
            if (isActionInProgress) {
                showNotification('‚è≥ Please wait, action in progress...');
                return;
            }
            await performAction('play_with_pet', 'üéÆ –ò–≥—Ä–∞—é...', '‚úÖ –ü–æ–∏–≥—Ä–∞–ª–∏!', 3_000_000_000);
            addToHistory('üéÆ –ü–æ–∏–≥—Ä–∞–ª');
        }

        window.healPet = async function() {
            if (isActionInProgress) {
                showNotification('‚è≥ Please wait, action in progress...');
                return;
            }
            await performAction('heal_pet', 'üíä –õ–µ—á—É...', '‚úÖ –í—ã–ª–µ—á–µ–Ω!', 8_000_000_000);
            addToHistory('üíä –í—ã–ª–µ—á–∏–ª');
        }

        window.drinkPet = async function() {
            if (isActionInProgress) {
                showNotification('‚è≥ Please wait, action in progress...');
                return;
            }
            await performAction('drink_pet', 'üçπ –ü–æ—é...', '‚úÖ –ù–∞–ø–æ–∏–ª!', 3_000_000_000);
            addToHistory('üçπ –ù–∞–ø–æ–∏–ª');
        }

        window.restPet = async function() {
            if (isActionInProgress) {
                showNotification('‚è≥ Please wait, action in progress...');
                return;
            }
            await performAction('rest_pet', 'üò¥ –û—Ç–¥—ã—Ö–∞—é...', '‚úÖ –û—Ç–¥–æ—Ö–Ω—É–ª!', 2_000_000_000);
            addToHistory('üò¥ –û—Ç–¥–æ—Ö–Ω—É–ª');
        }

        // üçñ Auto-Feed —Ñ—É–Ω–∫—Ü–∏—è (–≤—Ä–µ–º–µ–Ω–Ω–æ disabled)
        window.buyAutoFeed = async function() {
            showNotification('üöß Auto-Feed coming soon! Use regular Feed for now.');
            // TODO: Implement auto-feed smart contract integration
            // –ü–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        }

        async function performAction(actionName, loadingMsg, successMsg, burnAmount) {
            if (!wallet || !petPubkey || isActionInProgress) return;
            
            isActionInProgress = true; // üîí –ë–ª–æ–∫–∏—Ä—É–µ–º –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
            
            try {
                showNotification(loadingMsg);
                disableButtons();

                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                const tokenMintPubkey = new window.solanaWeb3.PublicKey(TOKEN_MINT);
                const tokenProgramId = new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID);
                const discriminator = await getInstructionDiscriminator(actionName);

                // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ Associated Token Account (MANUAL)
                const associatedTokenProgram = new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL');
                
                // 1. –í—ã—á–∏—Å–ª–∏—Ç—å TAMA Mint PDA (–Ω—É–∂–µ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)
                const tamaMintSeeds = new Uint8Array([116, 97, 109, 97, 95, 109, 105, 110, 116]); // "tama_mint" –≤ bytes
                const [tamaMintPDA] = window.solanaWeb3.PublicKey.findProgramAddressSync(
                    [tamaMintSeeds],
                    programId
                );
                console.log('üîë TAMA Mint PDA:', tamaMintPDA.toString());
                
                // 2. –í—ã—á–∏—Å–ª–∏—Ç—å user_tama_account (ATA –¥–ª—è TAMA Mint PDA)
                const [userTamaAccount] = window.solanaWeb3.PublicKey.findProgramAddressSync(
                    [
                        wallet.publicKey.toBuffer(),
                        tokenProgramId.toBuffer(),
                        tamaMintPDA.toBuffer()
                    ],
                    associatedTokenProgram
                );
                console.log('üîë User TAMA Account:', userTamaAccount.toString());
                
                // 3. –í—ã—á–∏—Å–ª–∏—Ç—å user_token_account (ATA –¥–ª—è –Ω–∞—à–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ 74KGR...)
                const [tokenAccountPubkey] = window.solanaWeb3.PublicKey.findProgramAddressSync(
                    [
                        wallet.publicKey.toBuffer(),
                        tokenProgramId.toBuffer(),
                        tokenMintPubkey.toBuffer()
                    ],
                    associatedTokenProgram
                );
                console.log('üîë User Token Account (ATA):', tokenAccountPubkey.toString());
                console.log('‚úÖ Manual ATA calculation (without library)');

                const transaction = new window.solanaWeb3.Transaction();

                // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å user_token_account –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                try {
                    const accountInfo = await connection.getAccountInfo(tokenAccountPubkey);
                    if (!accountInfo) {
                        console.log('üî® –°–æ–∑–¥–∞—é user_token_account (ATA for 74KGR...)...');
                        
                        const createATAIx = new window.solanaWeb3.TransactionInstruction({
                            keys: [
                                { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                                { pubkey: tokenAccountPubkey, isSigner: false, isWritable: true },
                                { pubkey: wallet.publicKey, isSigner: false, isWritable: false },
                                { pubkey: tokenMintPubkey, isSigner: false, isWritable: false },
                                { pubkey: window.solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                                { pubkey: tokenProgramId, isSigner: false, isWritable: false },
                            ],
                            programId: associatedTokenProgram,
                            data: new Uint8Array([]),
                        });
                        transaction.add(createATAIx);
                        console.log('‚úÖ user_token_account instruction added');
                    } else {
                        console.log('‚úÖ user_token_account already exists');
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è user_token_account check failed:', err);
                }
                
                // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å user_tama_account –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                try {
                    const tamaAccountInfo = await connection.getAccountInfo(userTamaAccount);
                    if (!tamaAccountInfo) {
                        console.log('üî® –°–æ–∑–¥–∞—é user_tama_account (ATA for TAMA PDA)...');
                        
                        const createTamaATAIx = new window.solanaWeb3.TransactionInstruction({
                            keys: [
                                { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                                { pubkey: userTamaAccount, isSigner: false, isWritable: true },
                                { pubkey: wallet.publicKey, isSigner: false, isWritable: false },
                                { pubkey: tamaMintPDA, isSigner: false, isWritable: false },
                                { pubkey: window.solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                                { pubkey: tokenProgramId, isSigner: false, isWritable: false },
                            ],
                            programId: associatedTokenProgram,
                            data: new Uint8Array([]),
                        });
                        transaction.add(createTamaATAIx);
                        console.log('‚úÖ user_tama_account instruction added');
                    } else {
                        console.log('‚úÖ user_tama_account already exists');
                    }
                } catch (err) {
                    console.warn('‚ö†Ô∏è user_tama_account check failed:', err);
                }

                // ‚úÖ –í—Å–µ accounts –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!)
                const actionKeys = [
                    { pubkey: petPubkey, isSigner: false, isWritable: true },              // 1. pet
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },        // 2. owner
                    { pubkey: tokenAccountPubkey, isSigner: false, isWritable: true },     // 3. user_token_account
                    { pubkey: tamaMintPDA, isSigner: false, isWritable: true },            // 4. tama_mint (PDA)
                    { pubkey: userTamaAccount, isSigner: false, isWritable: true },        // 5. user_tama_account
                    { pubkey: tokenMintPubkey, isSigner: false, isWritable: true },        // 6. token_mint (74KGR...)
                    { pubkey: tokenProgramId, isSigner: false, isWritable: false },        // 7. token_program
                ];
                
                console.log('üìã Action Keys (7 accounts):');
                console.log('  1. pet:', petPubkey.toString());
                console.log('  2. owner:', wallet.publicKey.toString());
                console.log('  3. user_token_account:', tokenAccountPubkey.toString());
                console.log('  4. tama_mint:', tamaMintPDA.toString());
                console.log('  5. user_tama_account:', userTamaAccount.toString());
                console.log('  6. token_mint:', tokenMintPubkey.toString());
                console.log('  7. token_program:', tokenProgramId.toString());

                const actionInstruction = new window.solanaWeb3.TransactionInstruction({
                    keys: actionKeys,
                    programId,
                    data: discriminator,
                });

                transaction.add(actionInstruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                
                await connection.confirmTransaction(signature, 'confirmed');
                
                // üí´ –û–ü–´–¢ –ó–ê –î–ï–ô–°–¢–í–ò–ï (+5 EXP)!
                if (realPetData && realPetData.isAlive) {
                    realPetData.experience += 5;
                    checkLevelUp();
                    addToHistory(`${successMsg} (+5 EXP)`);
                }
                
                showNotification(successMsg + ' (+5 EXP)');
                await refreshPet();
                
                // üéØ –û–±–Ω–æ–≤–∏—Ç—å TAMA –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è
                await updateTamaBalance();
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞:', err);
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
                if (err.message && err.message.includes('already been processed')) {
                    showNotification('‚è≥ Transaction already processing...');
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    await refreshPet(); // –ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                } else {
                    showNotification('‚ùå Error: ' + err.message);
                }
            } finally {
                // üîì –í—Å–µ–≥–¥–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Ü–µ
                isActionInProgress = false;
                enableButtons();
            }
        }

        async function getAssociatedTokenAddress(tokenMint, owner) {
            const [address] = await window.solanaWeb3.PublicKey.findProgramAddress(
                [
                    owner.toBytes(),
                    new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID).toBytes(),
                    tokenMint.toBytes(),
                ],
                window.solanaWeb3.ASSOCIATED_TOKEN_PROGRAM_ID
            );
            return address;
        }

        async function getOrCreateTokenAccount() {
            try {
                const tokenMintPubkey = new window.solanaWeb3.PublicKey(TOKEN_MINT);
                const associatedTokenAddress = await window.solanaWeb3.PublicKey.findProgramAddress(
                    [
                        wallet.publicKey.toBytes(),
                        new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID).toBytes(),
                        tokenMintPubkey.toBytes()
                    ],
                    new window.solanaWeb3.PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL')
                );
                
                return associatedTokenAddress[0];
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è token account:', err);
                return null;
            }
        }

        async function getTokenBalance() {
            try {
                const tokenAccount = await getOrCreateTokenAccount();
                const balance = await connection.getTokenAccountBalance(tokenAccount);
                return balance.value.amount;
            } catch (err) {
                return 0;
            }
        }

        async function updateTokenBalance() {
            try {
                const balance = await getTokenBalance();
                const tamaBalance = (balance / 1_000_000_000).toFixed(0);
                const tamaEl = document.getElementById('tamaBalance');
                if (tamaEl) tamaEl.textContent = tamaBalance;
            } catch (err) {
                const tamaEl = document.getElementById('tamaBalance');
                if (tamaEl) tamaEl.textContent = '...';
            }
        }

        async function refreshPet() {
            if (!wallet || !petPubkey) return;
            
            try {
                const accountInfo = await connection.getAccountInfo(petPubkey);
                
                if (accountInfo && accountInfo.data) {
                    const pet = deserializePet(accountInfo.data);
                    realPetData = pet;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∂–∏–∑–Ω–∏ –∏–∑ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
                    petLives = pet.lives || 3;
                    
                    updateDisplay(pet);
                    updateLivesDisplay();
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', err);
            }
        }

        window.closePetAccount = async function() {
            if (!wallet || !petPubkey) return;
            
            if (!confirm('üíÄ –ó–∞–∫—Ä—ã—Ç—å –∞–∫–∫–∞—É–Ω—Ç –ø–∏—Ç–æ–º—Ü–∞?\n\n‚úÖ Rent –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω\n‚ö†Ô∏è –ü–∏—Ç–æ–º–µ—Ü –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –Ω–∞–≤—Å–µ–≥–¥–∞')) {
                return;
            }
            
            try {
                showNotification('üîÑ Closing account...');
                
                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                
                // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Anchor discriminator –¥–ª—è close_pet
                const data = new Uint8Array([204, 184, 224, 2, 62, 15, 58, 163]); // close_pet instruction
                
                const closeKeys = [
                    { pubkey: petPubkey, isSigner: false, isWritable: true },
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                ];

                const instruction = new window.solanaWeb3.TransactionInstruction({
                    keys: closeKeys,
                    programId,
                    data,
                });

                const transaction = new window.solanaWeb3.Transaction().add(instruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                
                await connection.confirmTransaction(signature, 'confirmed');
                
                showNotification('‚úÖ Account closed! Rent returned.');
                
                document.getElementById('gameScreen').style.display = 'none';
                document.getElementById('createScreen').style.display = 'block';
                petPubkey = null;
                stopRealtimeUpdates();
                
            } catch (err) {
                showNotification('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
                console.error('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:', err);
            }
        }
        
        // ‚ù§Ô∏è –°–ò–°–¢–ï–ú–ê –ñ–ò–ó–ù–ï–ô
        
        function updateLivesDisplay() {
            const livesEl = document.getElementById('petLives');
            if (!livesEl) return;
            
            // –ë–µ—Ä–µ–º –∂–∏–∑–Ω–∏ –∏–∑ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏–ª–∏ localStorage
            const lives = realPetData ? realPetData.lives : petLives;
            const hearts = '‚ù§Ô∏è'.repeat(lives);
            const broken = 'üñ§'.repeat(Math.max(0, 3 - lives));
            livesEl.textContent = hearts + broken;
        }
        
        function loadLivesFromStorage() {
            if (!wallet) return;
            
            const walletKey = wallet.publicKey.toString();
            const savedLives = localStorage.getItem(`petLives_${walletKey}`);
            const savedDeaths = localStorage.getItem(`deathCount_${walletKey}`);
            
            if (savedLives) {
                petLives = parseInt(savedLives) || 3;
            }
            if (savedDeaths) {
                deathCount = parseInt(savedDeaths) || 0;
            }
            
            updateLivesDisplay();
        }
        
        function saveLivesToStorage() {
            if (!wallet) return;
            
            const walletKey = wallet.publicKey.toString();
            localStorage.setItem(`petLives_${walletKey}`, petLives.toString());
            localStorage.setItem(`deathCount_${walletKey}`, deathCount.toString());
        }
        
        function useLife() {
            if (petLives > 0) {
                petLives--;
                deathCount++;
                saveLivesToStorage();
                updateLivesDisplay();
                return true;
            }
            return false;
        }
        
        // üíÄ –í–û–°–ö–†–ï–®–ï–ù–ò–ï –ü–ò–¢–û–ú–¶–ê
        
        window.resurrectFree = async function() {
            if (!wallet || !petPubkey) return;
            
            try {
                showNotification('‚ú® Resurrecting pet for free...');
                
                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                
                // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Anchor discriminator –¥–ª—è resurrect_pet
                const data = new Uint8Array([142, 237, 125, 147, 199, 109, 53, 14]); // resurrect_pet instruction
                
                const freeKeys = [
                    { pubkey: petPubkey, isSigner: false, isWritable: true },
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                ];
                
                const instruction = new window.solanaWeb3.TransactionInstruction({
                    keys: freeKeys,
                    programId,
                    data,
                });
                
                const transaction = new window.solanaWeb3.Transaction().add(instruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                
                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature, 'confirmed');
                
                showNotification('‚ú® Pet resurrected for free!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await checkExistingPet();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è:', error);
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        window.resurrectWithSOL = async function() {
            if (!wallet || !petPubkey) return;
            
            showNotification('üíé Resurrection for SOL temporarily disabled! Use free resurrection.');
            return;
        }
        
        window.resurrectWithTAMA = async function() {
            if (!wallet || !petPubkey) return;
            
            showNotification('üî• Resurrection for TAMA temporarily disabled! Use free resurrection.');
            return;
            
            if (!confirm('üî• –í–æ—Å–∫—Ä–µ—Å–∏—Ç—å –∑–∞ 5,000 TAMA?\n\n‚ö†Ô∏è –¢–æ–∫–µ–Ω—ã –±—É–¥—É—Ç –°–û–ñ–ñ–ï–ù–´\n‚úÖ –ü–∏—Ç–æ–º–µ—Ü –æ–∂–∏–≤–µ—Ç —Å 50% —Å—Ç–∞—Ç–æ–≤')) {
                return;
            }
            
            try {
                showNotification('üíÄ‚û°Ô∏èüê£ Resurrecting pet...');
                
                const programId = new window.solanaWeb3.PublicKey(PROGRAM_ID);
                const discriminator = await getInstructionDiscriminator('resurrect_pet');
                
                // Treasury address - Team Wallet
                const treasury = new window.solanaWeb3.PublicKey(TEAM_WALLET);
                
                // use_sol = false (0 byte)
                const useSol = new Uint8Array([0]);
                const data = new Uint8Array([...discriminator, ...useSol]);
                
                const tokenMint = new window.solanaWeb3.PublicKey(TOKEN_MINT);
                const userTokenAccount = await getAssociatedTokenAddress(tokenMint, wallet.publicKey);
                const tokenProgramId = new window.solanaWeb3.PublicKey(TOKEN_PROGRAM_ID);
                const systemProgramId = window.solanaWeb3.SystemProgram.programId;
                
                const resurrectKeys = [
                    { pubkey: petPubkey, isSigner: false, isWritable: true },
                    { pubkey: wallet.publicKey, isSigner: true, isWritable: true },
                    { pubkey: treasury, isSigner: false, isWritable: true },
                    { pubkey: userTokenAccount, isSigner: false, isWritable: true },
                    { pubkey: tokenMint, isSigner: false, isWritable: true },
                    { pubkey: tokenProgramId, isSigner: false, isWritable: false },
                    { pubkey: systemProgramId, isSigner: false, isWritable: false },
                ];
                
                const instruction = new window.solanaWeb3.TransactionInstruction({
                    keys: resurrectKeys,
                    programId,
                    data,
                });
                
                const transaction = new window.solanaWeb3.Transaction().add(instruction);
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                
                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature, 'confirmed');
                
                showNotification('üéâ Pet resurrected! 5,000 TAMA burned!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await checkExistingPet();
                await updateTokenBalance();
                
            } catch (err) {
                showNotification('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–∫—Ä–µ—à–µ–Ω–∏—è:', err);
            }
        }

        // üî• ADDICTED.FUN STYLE –ú–ï–•–ê–ù–ò–ö–ò
        
        // üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï/–ó–ê–ì–†–£–ó–ö–ê –ò–ó LOCALSTORAGE
        function saveGameState() {
            if (!wallet) return;
            
            const walletKey = wallet.publicKey.toString();
            const gameState = {
                totalClicks: totalClicks,
                clickCount: clickCount,
                autoClickers: autoClickers,
                lastLoginTime: Date.now()
            };
            
            localStorage.setItem(`gameState_${walletKey}`, JSON.stringify(gameState));
        }
        
        function loadGameState() {
            if (!wallet) return;
            
            const walletKey = wallet.publicKey.toString();
            const saved = localStorage.getItem(`gameState_${walletKey}`);
            
            if (saved) {
                const gameState = JSON.parse(saved);
                totalClicks = gameState.totalClicks || 0;
                clickCount = gameState.clickCount || 0;
                autoClickers = gameState.autoClickers || 0;
                lastLoginTime = gameState.lastLoginTime || Date.now();
                
                console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã:', gameState);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä—ã –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                if (autoClickers > 0 && !autoClickInterval) {
                    startAutoClicks();
                }
            }
        }
        
        // üí∞ OFFLINE REWARDS
        function calculateOfflineRewards() {
            if (!wallet || autoClickers === 0) return 0;
            
            const now = Date.now();
            const timePassed = (now - lastLoginTime) / 1000; // —Å–µ–∫—É–Ω–¥—ã
            
            // –ú–∞–∫—Å–∏–º—É–º 24 —á–∞—Å–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
            const maxSeconds = MAX_OFFLINE_HOURS * 60 * 60;
            const cappedSeconds = Math.min(timePassed, maxSeconds);
            
            // Reward = –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã √ó —Å–µ–∫—É–Ω–¥—ã √ó –∫–ª–∏–∫–æ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É
            const offlineReward = Math.floor(autoClickers * cappedSeconds * CLICKS_PER_SECOND);
            
            return offlineReward;
        }
        
        function claimOfflineRewards() {
            const reward = calculateOfflineRewards();
            
            if (reward > 0) {
                totalClicks += reward;
                
                const hours = Math.floor((Date.now() - lastLoginTime) / (1000 * 60 * 60));
                const minutes = Math.floor(((Date.now() - lastLoginTime) / (1000 * 60)) % 60);
                
                let timeText = '';
                if (hours > 0) {
                    timeText = `${hours}—á ${minutes}–º`;
                } else {
                    timeText = `${minutes}–º`;
                }
                
                showNotification(`üí∞ Offline –Ω–∞–≥—Ä–∞–¥–∞: +${reward.toLocaleString()} –∫–ª–∏–∫–æ–≤ –∑–∞ ${timeText}!`);
                console.log(`üí∞ Offline rewards: ${reward} –∫–ª–∏–∫–æ–≤ –∑–∞ ${timeText}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                lastLoginTime = Date.now();
                saveGameState();
            }
        }
        
        async function payEntryFee() {
            if (!wallet) {
                showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏ –∫–æ—à–µ–ª–µ–∫!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage –¥–ª—è —ç—Ç–æ–≥–æ wallet
            const walletKey = wallet.publicKey.toString();
            const savedEntryFee = localStorage.getItem(`entryFeePaid_${walletKey}`);
            
            // –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–π –æ–ø–ª–∞—Ç—ã
            if (entryFeePaid || savedEntryFee === 'true') {
                entryFeePaid = true;
                showNotification('‚úÖ –í—Ö–æ–¥ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω! –°–æ–∑–¥–∞—é –ø–∏—Ç–æ–º—Ü–∞...');
                createPet();
                return;
            }
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            const btn = document.getElementById('payEntryBtn');
            if (btn) btn.disabled = true;
            
            try {
                showNotification('üíé –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –ø–ª–∞—Ç–µ–∂...');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º 0.1 SOL –≤ Team Treasury
                const treasuryPubkey = new window.solanaWeb3.PublicKey(TEAM_WALLET);
                const transaction = new window.solanaWeb3.Transaction().add(
                    window.solanaWeb3.SystemProgram.transfer({
                        fromPubkey: wallet.publicKey,
                        toPubkey: treasuryPubkey,
                        lamports: 0.1 * window.solanaWeb3.LAMPORTS_PER_SOL
                    })
                );
                
                transaction.feePayer = wallet.publicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
                
                const signed = await wallet.signTransaction(transaction);
                const signature = await connection.sendRawTransaction(signed.serialize());
                await connection.confirmTransaction(signature);
                
                // –î–∞–µ–º 1000 TAMA —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å
                entryFeePaid = true;
                const walletKey = wallet.publicKey.toString();
                localStorage.setItem(`entryFeePaid_${walletKey}`, 'true');
                localStorage.setItem(`entryFeeTimestamp_${walletKey}`, Date.now().toString());
                
                showNotification('‚úÖ –í—Ö–æ–¥ –æ–ø–ª–∞—á–µ–Ω! –°–æ–∑–¥–∞—é –ø–∏—Ç–æ–º—Ü–∞...');
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–æ–∑–¥–∞–Ω–∏—é –ø–∏—Ç–æ–º—Ü–∞
                createPet();
                
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã:', err);
                
                // –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ - —ç—Ç–æ —É—Å–ø–µ—Ö!
                if (err.message && err.message.includes('already been processed')) {
                    console.log('‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ - –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞!');
                    entryFeePaid = true;
                    const walletKey = wallet.publicKey.toString();
                    localStorage.setItem(`entryFeePaid_${walletKey}`, 'true');
                    localStorage.setItem(`entryFeeTimestamp_${walletKey}`, Date.now().toString());
                    showNotification('‚úÖ –í—Ö–æ–¥ –æ–ø–ª–∞—á–µ–Ω! –°–æ–∑–¥–∞—é –ø–∏—Ç–æ–º—Ü–∞...');
                    createPet();
                } else if (err.message && err.message.includes('insufficient lamports')) {
                    // –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ SOL
                    showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ SOL! –ü–æ–ª—É—á–∏ Devnet SOL: faucet.solana.com');
                    const btn = document.getElementById('payEntryBtn');
                    if (btn) btn.disabled = false;
                } else {
                    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–µ
                    const btn = document.getElementById('payEntryBtn');
                    if (btn) btn.disabled = false;
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ' + err.message);
                }
            }
        }
        
        // ‚ùå –£–ë–†–ê–õ–ò –û–ë–´–ß–ù–´–ï –ö–õ–ò–ö–ò - –¢–û–õ–¨–ö–û –ê–í–¢–û–ö–õ–ò–ö–ï–†!
        
        // ü§ñ OFFLINE REWARDS
        function calculateOfflineReward() {
            if (autoClickers === 0) return 0;
            
            const now = Date.now();
            const timeOffline = (now - lastLoginTime) / 1000; // —Å–µ–∫—É–Ω–¥—ã
            const maxOfflineSeconds = MAX_OFFLINE_HOURS * 3600; // 24 —á–∞—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            const cappedTime = Math.min(timeOffline, maxOfflineSeconds);
            
            return Math.floor(cappedTime * autoClickers); // 1 TAMA/—Å–µ–∫ –∑–∞ –∫–∞–∂–¥—ã–π –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä
        }
        
        function claimOfflineRewards() {
            const reward = calculateOfflineReward();
            if (reward > 0) {
                totalClicks += reward;
                lastLoginTime = Date.now();
                updateClickStats();
                showNotification(`üí∞ –ü–æ–ª—É—á–µ–Ω–æ ${reward} TAMA –∑–∞ offline –≤—Ä–µ–º—è!`);
                addToHistory(`üí∞ Offline: +${reward} TAMA`);
            }
        }
        
        function getTamaPerClick() {
            const baseExp = 1;
            const levelBonus = realPetData.level * 0.5;
            const autoClickerBonus = autoClickers * 0.1;
            return Math.floor(baseExp + levelBonus + autoClickerBonus);
        }
        
        async function buyAutoClicker() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
            if (autoClickers >= MAX_AUTO_CLICKERS) {
                showNotification(`‚ùå –ú–∞–∫—Å–∏–º—É–º ${MAX_AUTO_CLICKERS} –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä–æ–≤ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!`);
                return;
            }
            
            const cost = getAutoClickerCost();
            const tokenBalance = await getTokenBalance();
            
            if (tokenBalance < cost) {
                showNotification(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TAMA! –ù—É–∂–Ω–æ: ${cost}`);
                return;
            }
            
            // –°–∂–∏–≥–∞–µ–º —Ç–æ–∫–µ–Ω—ã (–∏–º–∏—Ç–∞—Ü–∏—è)
            // burnTokens(cost);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä
            autoClickers++;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ-–∫–ª–∏–∫–∏ –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã
            if (!autoClickInterval) {
                startAutoClicks();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateClickStats();
            
            // üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            saveGameState();
            
            showNotification(`ü§ñ –ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä #${autoClickers} –∫—É–ø–ª–µ–Ω! –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ${autoClickers} TAMA/—Å–µ–∫`);
            
            const remaining = MAX_AUTO_CLICKERS - autoClickers;
            const nextCost = getAutoClickerCost();
            
            if (remaining > 0) {
                showNotification(`‚úÖ –ö—É–ø–∏–ª –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä! –¢–µ–ø–µ—Ä—å: ${autoClickers}/${MAX_AUTO_CLICKERS}\nüí∞ –°–ª–µ–¥—É—é—â–∏–π: ${nextCost} TAMA`);
            } else {
                showNotification(`‚úÖ –ö—É–ø–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä! –í—Å–µ–≥–æ: ${autoClickers}/${MAX_AUTO_CLICKERS}`);
            }
            
            addToHistory(`ü§ñ –ö—É–ø–∏–ª –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä #${autoClickers} –∑–∞ ${cost} TAMA`);
        }
        
        function getAutoClickerCost() {
            return Math.floor(100 * Math.pow(1.5, autoClickers));
        }
        
        function startAutoClicks() {
            autoClickInterval = setInterval(() => {
                if (realPetData && realPetData.isAlive && autoClickers > 0) {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º TAMA –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                    const tamaGain = autoClickers; // 1 TAMA –∑–∞ –∫–∞–∂–¥—ã–π –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä
                    totalClicks += autoClickers;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    updateClickStats();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∂–¥—ã–µ 100 TAMA
                    if (totalClicks % 100 === 0) {
                        addToHistory(`ü§ñ –ê–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä—ã: +${tamaGain} TAMA/—Å–µ–∫`);
                    }
                }
            }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        }
        
        function updateClickStats() {
            if (!realPetData) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤—Ç–æ-–∫–ª–∏–∫–µ—Ä—ã
            document.getElementById('autoClickerCount').textContent = `${autoClickers}/${MAX_AUTO_CLICKERS}`;
            document.getElementById('tamaPerSec').textContent = autoClickers; // TAMA/—Å–µ–∫
            
            // Offline rewards
            const offlineReward = calculateOfflineReward();
            document.getElementById('offlineReward').textContent = offlineReward.toLocaleString();
            
            // –í—Ä–µ–º—è –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ claim
            const timeToClaim = Math.max(0, 60 - (Date.now() - lastLoginTime) / 1000);
            document.getElementById('timeToClaim').textContent = Math.floor(timeToClaim) + '—Å';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –∫–Ω–æ–ø–∫—É
            const costEl = document.getElementById('autoClickerCost');
            const btn = document.getElementById('autoClickerBtn');
            
            if (autoClickers >= MAX_AUTO_CLICKERS) {
                costEl.textContent = '–ú–ê–ö–°';
                if (btn) btn.disabled = true;
                document.getElementById('autoClickerProgress').style.display = 'none';
            } else {
                const cost = getAutoClickerCost();
                costEl.textContent = cost + ' TAMA';
                if (btn) btn.disabled = false;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
                const progressDiv = document.getElementById('autoClickerProgress');
                const tamaToNextEl = document.getElementById('tamaToNext');
                const progressBar = document.getElementById('autoClickerProgressBar');
                
                if (progressDiv && tamaToNextEl && progressBar) {
                    progressDiv.style.display = 'block';
                    
                    const currentTama = clickCount; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∏–∫–∏ –∫–∞–∫ TAMA
                    const needed = cost - currentTama;
                    tamaToNextEl.textContent = needed > 0 ? needed.toLocaleString() : '0';
                    
                    const progress = Math.min((currentTama / cost) * 100, 100);
                    progressBar.style.width = progress + '%';
                }
            }
        }
        
        function checkLevelUp() {
            const expToNext = getExpToNextLevel(realPetData.level);
            if (realPetData.experience >= expToNext) {
                realPetData.level++;
                realPetData.experience -= expToNext;
                showNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å ${realPetData.level}! –ë–æ–ª—å—à–µ TAMA –∑–∞ –∫–ª–∏–∫!`);
                addToHistory(`üéâ –ü–æ–≤—ã—Å–∏–ª —É—Ä–æ–≤–µ–Ω—å –¥–æ ${realPetData.level}`);
                updateDisplay(realPetData);
            }
        }
        
        function playClickSound() {
            // –ü—Ä–æ—Å—Ç–æ–π –∑–≤—É–∫ —á–µ—Ä–µ–∑ Web Audio API
            try {
                const audioContext = new AudioContext();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –∑–≤—É–∫–∞
            }
        }
        
        function petClick() {
            // –°—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
            clickPet();
        }
        
        // üí∞ REFERRAL SYSTEM FUNCTIONS
        
        function toggleReferral() {
            const panel = document.getElementById('referralPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –ø–∞–Ω–µ–ª–∏
                document.getElementById('historyPanel').style.display = 'none';
                document.getElementById('statsPanel').style.display = 'none';
            } else {
                panel.style.display = 'none';
            }
        }
        
        function generateReferralCode() {
            if (!wallet || !wallet.publicKey) return '';
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ wallet address –∫–∞–∫ referral code
            const address = wallet.publicKey.toString();
            return address.slice(0, 8);
        }
        
        function updateReferralLink() {
            if (!wallet) return;
            
            referralCode = generateReferralCode();
            const baseUrl = window.location.origin + window.location.pathname;
            const referralLink = `${baseUrl}?ref=${referralCode}`;
            
            const refLinkEl = document.getElementById('referralLink');
            if (refLinkEl) {
                refLinkEl.value = referralLink;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–¥–ª—è –¥–µ–º–æ) - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
            const refCountEl = document.getElementById('referralCount');
            const refEarningsEl = document.getElementById('referralEarnings');
            
            if (refCountEl) refCountEl.textContent = totalReferrals;
            if (refEarningsEl) refEarningsEl.textContent = (referralEarnings / 1000000000).toFixed(2) + ' SOL';
        }
        
        function copyReferralLink() {
            const input = document.getElementById('referralLink');
            if (!input) {
                showNotification('‚ùå Referral link not available');
                return;
            }
            input.select();
            document.execCommand('copy');
            showNotification('‚úÖ Link copied!');
        }
        
        async function shareReferral() {
            const referralLink = document.getElementById('referralLink').value;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'üê£ Crypto Tamagotchi',
                        text: 'üéÅ –ü–æ–ª—É—á–∏ 100 TAMA –±–æ–Ω—É—Å! –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –∏–≥—Ä–µ:',
                        url: referralLink
                    });
                    showNotification('‚úÖ –ü–æ–¥–µ–ª–∏–ª—Å—è!');
                } catch (err) {
                    copyReferralLink();
                }
            } else {
                // Fallback –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                const text = `üéÅ –ü–æ–ª—É—á–∏ 100 TAMA –±–æ–Ω—É—Å!\n\nüê£ Crypto Tamagotchi - –∏–≥—Ä–∞–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π!\n\n${referralLink}`;
                
                // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –ü–æ–¥–µ–ª–∏—Å—å —Å –¥—Ä—É–∑—å—è–º–∏!');
                });
            }
        }
        
        function checkReferralCode() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ referral code
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            
            if (ref) {
                referredBy = ref;
                console.log('üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:', ref);
                showNotification('üéÅ –ë–æ–Ω—É—Å –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('referredBy', ref);
            } else {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–æ–¥
                const savedRef = localStorage.getItem('referredBy');
                if (savedRef) {
                    referredBy = savedRef;
                }
            }
        }
        
        async function processReferralReward() {
            if (!referredBy || entryFeePaid) return;
            
            // TODO: –û—Ç–ø—Ä–∞–≤–∏—Ç—å 10% –æ—Ç Entry Fee —Ä–µ—Ñ–µ—Ä–µ—Ä—É
            // TODO: –î–∞—Ç—å 100 TAMA –±–æ–Ω—É—Å –Ω–æ–≤–æ–º—É –∏–≥—Ä–æ–∫—É
            
            console.log('üí∞ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è:', referredBy);
            showNotification('üéÅ –ü–æ–ª—É—á–∏–ª 100 TAMA –±–æ–Ω—É—Å –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞!');
        }

        function disableButtons() {
            document.getElementById('feedBtn').disabled = true;
            document.getElementById('playBtn').disabled = true;
            document.getElementById('healBtn').disabled = true;
            document.getElementById('restBtn').disabled = true;
        }

        function enableButtons() {
            if (realPetData && realPetData.isAlive) {
                document.getElementById('feedBtn').disabled = false;
                document.getElementById('playBtn').disabled = false;
                document.getElementById('healBtn').disabled = false;
                document.getElementById('restBtn').disabled = false;
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.innerHTML = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ============================================================================
        // –ò–°–¢–û–†–ò–Ø –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        // ============================================================================

        function toggleHistory() {
            const panel = document.getElementById('historyPanel');
            panel.classList.toggle('show');
        }

        function toggleStats() {
            const panel = document.getElementById('statsPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        function addToHistory(action) {
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
            
            actionHistory.unshift({ action, time: timeStr });
            if (actionHistory.length > 5) {
                actionHistory.pop();
            }
            
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const listEl = document.getElementById('historyList');
            
            if (actionHistory.length === 0) {
                listEl.innerHTML = `<div style="text-align: center; color: #999; font-size: 0.85em; padding: 20px;">
                    –ü–æ–∫–∞ –Ω–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π
                </div>`;
                return;
            }
            
            let html = '';
            actionHistory.forEach(item => {
                html += `<div class="history-item">
                    <span class="history-action">${item.action}</span>
                    <span class="history-time">${item.time}</span>
                </div>`;
            });
            
            listEl.innerHTML = html;
        }

        // ============================================================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================================================

        window.addEventListener('load', async () => {
            await init();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
            checkReferralCode();
            
            if (window.solana && window.solana.isPhantom) {
                try {
                    const resp = await window.solana.connect({ onlyIfTrusted: true });
                    wallet = window.solana;
                    
                    const address = resp.publicKey.toString();
                    const short = address.slice(0, 4) + '...' + address.slice(-4);
                    
                    document.getElementById('connectBtn').textContent = short;
                    document.getElementById('walletAddress').textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω: ' + short;
                    document.getElementById('walletAddress').style.display = 'block';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
                    updateReferralLink();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å Entry Fee
                    checkSavedEntryFee();
                    
                    await checkExistingPet();
                } catch (err) {
                    console.log('–ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å');
                }
            }
        });

        // üëë –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò
        function checkAdminAccess() {
            if (wallet && wallet.publicKey && ADMIN_WALLETS.includes(wallet.publicKey.toString())) {
                document.getElementById('adminPanel').style.display = 'block';
                loadAdminPrices();
            }
        }

        function loadAdminPrices() {
            document.getElementById('nftSolPrice').value = PRICES.NFT_SOL;
            document.getElementById('feedTamaPrice').value = PRICES.FEED_TAMA;
            document.getElementById('playTamaPrice').value = PRICES.PLAY_TAMA;
            document.getElementById('healTamaPrice').value = PRICES.HEAL_TAMA;
        }

        function updatePrice(priceType) {
            let newPrice;
            switch(priceType) {
                case 'NFT_SOL':
                    newPrice = parseFloat(document.getElementById('nftSolPrice').value);
                    PRICES.NFT_SOL = newPrice;
                    document.getElementById('nftPrice').textContent = newPrice;
                    break;
                case 'FEED_TAMA':
                    newPrice = parseInt(document.getElementById('feedTamaPrice').value);
                    PRICES.FEED_TAMA = newPrice;
                    break;
                case 'PLAY_TAMA':
                    newPrice = parseInt(document.getElementById('playTamaPrice').value);
                    PRICES.PLAY_TAMA = newPrice;
                    break;
                case 'HEAL_TAMA':
                    newPrice = parseInt(document.getElementById('healTamaPrice').value);
                    PRICES.HEAL_TAMA = newPrice;
                    break;
            }
            showNotification(`üí∞ –¶–µ–Ω–∞ ${priceType} –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${newPrice}`);
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞
        const originalConnectWallet = window.connectWallet;
        window.connectWallet = async function() {
            const result = await originalConnectWallet();
            setTimeout(checkAdminAccess, 1000);
            return result;
        };
    </script>

    <!-- üëë –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º) -->
    <div id="adminPanel" style="display: none; position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.9); color: white; padding: 20px; border-radius: 10px; border: 2px solid #FFD700; z-index: 1000; max-width: 300px;">
        <h3 style="color: #FFD700; margin-bottom: 15px;">üëë –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
        
        <div style="margin-bottom: 10px;">
            <label>üí∞ NFT –∑–∞ SOL:</label>
            <input type="number" id="nftSolPrice" step="0.001" style="width: 80px; margin-left: 10px; padding: 5px; border-radius: 5px; border: none;">
            <button onclick="updatePrice('NFT_SOL')" style="margin-left: 5px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">‚úì</button>
        </div>
        
        <div style="margin-bottom: 10px;">
            <label>üçñ –ö–æ—Ä–º–ª–µ–Ω–∏–µ TAMA:</label>
            <input type="number" id="feedTamaPrice" step="1" style="width: 60px; margin-left: 10px; padding: 5px; border-radius: 5px; border: none;">
            <button onclick="updatePrice('FEED_TAMA')" style="margin-left: 5px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">‚úì</button>
        </div>
        
        <div style="margin-bottom: 10px;">
            <label>üéÆ –ò–≥—Ä–∞ TAMA:</label>
            <input type="number" id="playTamaPrice" step="1" style="width: 60px; margin-left: 10px; padding: 5px; border-radius: 5px; border: none;">
            <button onclick="updatePrice('PLAY_TAMA')" style="margin-left: 5px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">‚úì</button>
        </div>
        
        <div style="margin-bottom: 15px;">
            <label>üíä –õ–µ—á–µ–Ω–∏–µ TAMA:</label>
            <input type="number" id="healTamaPrice" step="1" style="width: 60px; margin-left: 10px; padding: 5px; border-radius: 5px; border: none;">
            <button onclick="updatePrice('HEAL_TAMA')" style="margin-left: 5px; padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">‚úì</button>
        </div>
        
        <button onclick="closeAdminPanel()" style="width: 100%; padding: 10px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <!-- üí¨ CHAT WIDGET -->
    <div id="chatWidget" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
        <button id="chatToggle" onclick="toggleChat()" style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 3px solid rgba(255,255,255,0.3); cursor: pointer; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4); transition: all 0.3s;">
            <span style="font-size: 28px;">üí¨</span>
        </button>
        
        <div id="chatPopup" style="display: none; position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); overflow: hidden; border: 2px solid rgba(102, 126, 234, 0.3);">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; color: white; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
                <span>üê£ Gotchi Chat</span>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">‚úï</button>
            </div>
            <div id="chatMessages" style="height: 380px; overflow-y: auto; padding: 15px; background: rgba(255,255,255,0.5);">
                <div style="text-align: center; padding: 20px; color: #666;">
                    <p>üéÆ Welcome to Gotchi Game chat!</p>
                    <p style="font-size: 0.9em; margin-top: 10px;">Connect wallet to start chatting!</p>
                </div>
            </div>
            <div style="padding: 10px; background: rgba(255,255,255,0.8); border-top: 1px solid rgba(0,0,0,0.1);">
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="chatInput" placeholder="Type message..." style="flex: 1; padding: 10px; border: 2px solid rgba(102, 126, 234, 0.3); border-radius: 20px; outline: none;" onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button onclick="sendChatMessage()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold;">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- üö∞ DEVNET FAUCET BUTTON -->
    <button id="faucetBtn" onclick="requestDevnetAirdrop()" style="display: none; position: fixed; top: 80px; right: 20px; padding: 12px 20px; background: linear-gradient(135deg, #00D4AA 0%, #00A8CC 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(0, 212, 170, 0.3); z-index: 999;">
        üö∞ Get Devnet SOL
    </button>

    <!-- üí∞ TAMA TOKEN FAUCET BUTTON -->
    <button id="tamaFaucetBtn" onclick="requestTamaTokens()" style="display: none; position: fixed; top: 140px; right: 20px; padding: 12px 20px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); z-index: 999;">
        üí∞ Get Free TAMA
    </button>

    <!-- üêõ BUG REPORT BUTTON -->
    <button onclick="window.open('BUG_REPORT_FORM.html', '_blank')" style="display: block; position: fixed; top: 200px; right: 20px; padding: 12px 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); z-index: 999;">
        üêõ Report Bug
    </button>

    <!-- üß™ DEVNET WARNING MODAL -->
    <div id="devnetModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 20px; padding: 40px; max-width: 600px; margin: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">üß™ Welcome to Gotchi Game BETA!</h2>
            
            <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 10px;">‚ö†Ô∏è This is TEST version (Devnet)</h3>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li>‚úÖ Free to play (Devnet SOL)</li>
                    <li>‚úÖ Test all features</li>
                    <li>‚úÖ Find bugs ‚Üí Get rewards!</li>
                    <li>‚ö†Ô∏è NFTs are NOT real (Devnet only)</li>
                    <li>üéÅ Beta testers get bonuses at Mainnet launch!</li>
                </ul>
            </div>
            
            <div style="background: #f0f0f0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 10px;">üìù How to start:</h3>
                <ol style="margin-left: 20px; line-height: 1.8;">
                    <li>Connect Phantom wallet</li>
                    <li>Switch to Devnet in wallet settings</li>
                    <li>Click "Get Devnet SOL" button (top right)</li>
                    <li>Create your Gotchi!</li>
                    <li>Play & give feedback!</li>
                </ol>
            </div>
            
            <div style="background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); padding: 15px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;">
                <p style="font-weight: bold; font-size: 1.1em;">üíé Mainnet launch with REAL NFTs coming soon!</p>
                <p style="margin-top: 5px;">All beta testers will receive exclusive rewards!</p>
            </div>
            
            <button onclick="closeDevnetModal()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1em; font-weight: bold;">
                üöÄ Start Testing!
            </button>
        </div>
    </div>

    <script>
        // üí¨ CHAT FUNCTIONS
        let chatMessages = [];
        let currentUser = null;

        function toggleChat() {
            const popup = document.getElementById('chatPopup');
            const isVisible = popup.style.display !== 'none';
            popup.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible && window.solana && window.solana.publicKey) {
                if (!currentUser) {
                    currentUser = window.solana.publicKey.toString().slice(0, 4) + '...' + window.solana.publicKey.toString().slice(-4);
                }
                loadChatMessages();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            if (!window.solana || !window.solana.publicKey) {
                showNotification('‚ö†Ô∏è Connect wallet to chat!');
                return;
            }
            
            const chatMessage = {
                user: currentUser || 'Anonymous',
                message: message,
                timestamp: Date.now(),
                wallet: window.solana.publicKey.toString()
            };
            
            // Save to localStorage (simple solution)
            chatMessages.push(chatMessage);
            if (chatMessages.length > 100) chatMessages.shift(); // Keep last 100
            localStorage.setItem('gotchiChat', JSON.stringify(chatMessages));
            
            displayChatMessage(chatMessage);
            input.value = '';
        }

        function displayChatMessage(msg) {
            const container = document.getElementById('chatMessages');
            const isOwnMessage = window.solana && msg.wallet === window.solana.publicKey.toString();
            
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                margin-bottom: 10px;
                padding: 10px;
                background: ${isOwnMessage ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'rgba(255,255,255,0.8)'};
                color: ${isOwnMessage ? 'white' : '#333'};
                border-radius: 10px;
                border: 2px solid ${isOwnMessage ? 'rgba(255,255,255,0.3)' : 'rgba(102, 126, 234, 0.2)'};
            `;
            
            const time = new Date(msg.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            messageDiv.innerHTML = `
                <div style="font-weight: bold; font-size: 0.85em; margin-bottom: 5px;">
                    ${msg.user} <span style="opacity: 0.7; font-weight: normal;">${time}</span>
                </div>
                <div>${msg.message}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function loadChatMessages() {
            const stored = localStorage.getItem('gotchiChat');
            if (stored) {
                chatMessages = JSON.parse(stored);
                const container = document.getElementById('chatMessages');
                container.innerHTML = '';
                chatMessages.forEach(msg => displayChatMessage(msg));
            }
        }

        // üö∞ DEVNET FAUCET
        // üí∞ TAMA Token Faucet
        async function requestTamaTokens() {
            if (!window.solana || !window.solana.publicKey) {
                showNotification('‚ö†Ô∏è Connect wallet first!');
                return;
            }
            
            const walletAddress = window.solana.publicKey.toString();
            
            // Show modal with instructions
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; display: flex; justify-content: center; align-items: center; padding: 20px;';
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); color: white;">
                    <h2 style="margin-bottom: 20px; text-align: center;">üí∞ Get Free TAMA Tokens</h2>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="margin-bottom: 10px;"><strong>Your Wallet:</strong></p>
                        <p style="font-size: 0.85em; word-break: break-all; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px;">${walletAddress}</p>
                    </div>
                    
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="margin-bottom: 10px;">üìù <strong>How to get TAMA:</strong></p>
                        <ol style="margin-left: 20px; line-height: 1.8; font-size: 0.9em;">
                            <li>Copy your wallet address above</li>
                            <li>Click "Request Tokens" below</li>
                            <li>You'll receive <strong>1000 TAMA</strong> tokens!</li>
                            <li>Wait 10 seconds for confirmation</li>
                        </ol>
                    </div>
                    
                    <div style="background: rgba(76, 175, 80, 0.1); padding: 12px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="font-size: 0.9em; text-align: center;">
                            ‚ö° Faucet limit: <strong>1000 TAMA</strong> per request<br>
                            ‚è∞ Cooldown: <strong>5 minutes</strong>
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="this.closest('div[style*=fixed]').remove()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.2); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer;">
                            Cancel
                        </button>
                        <button onclick="sendTamaAirdrop('${walletAddress}'); this.closest('div[style*=fixed]').remove();" style="flex: 2; padding: 12px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
                            üí∞ Request 1000 TAMA
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Send TAMA tokens via airdrop script
        async function sendTamaAirdrop(walletAddress) {
            try {
                showNotification('üí∞ Requesting TAMA tokens...');
                
                // Call airdrop script or backend API
                // For now, show instructions
                const lastAirdrop = localStorage.getItem('lastTamaAirdrop_' + walletAddress);
                const now = Date.now();
                
                if (lastAirdrop && (now - parseInt(lastAirdrop)) < 5 * 60 * 1000) {
                    const remainingTime = Math.ceil((5 * 60 * 1000 - (now - parseInt(lastAirdrop))) / 60000);
                    showNotification(`‚è∞ Cooldown active! Wait ${remainingTime} more minutes.`);
                    return;
                }
                
                // Save airdrop time
                localStorage.setItem('lastTamaAirdrop_' + walletAddress, now.toString());
                
                // Show success message with instructions
                showNotification('‚úÖ TAMA request sent! Check wallet in 10 seconds...');
                
                // Simulate airdrop (in production, call backend API)
                setTimeout(() => {
                    showNotification('‚ö†Ô∏è TAMA Faucet coming soon! For now, actions are FREE (no TAMA needed)');
                    updateTamaBalance();
                }, 3000);
                
            } catch (err) {
                console.error('TAMA Airdrop error:', err);
                showNotification('‚ùå Error requesting TAMA. Try again later.');
            }
        }

        async function requestDevnetAirdrop() {
            if (!window.solana || !window.solana.publicKey) {
                showNotification('‚ö†Ô∏è Connect wallet first!');
                return;
            }
            
            try {
                showNotification('üö∞ Requesting 2 Devnet SOL...');
                
                const signature = await connection.requestAirdrop(
                    window.solana.publicKey,
                    2 * window.solanaWeb3.LAMPORTS_PER_SOL
                );
                
                await connection.confirmTransaction(signature);
                showNotification('‚úÖ Received 2 Devnet SOL!');
                
                // Update balance
                setTimeout(updateBalance, 1000);
            } catch (err) {
                console.error('Airdrop error:', err);
                showNotification('‚ö†Ô∏è Airdrop failed! Use: https://faucet.solana.com');
                window.open('https://faucet.solana.com', '_blank');
            }
        }

        // üß™ DEVNET MODAL
        function showDevnetModal() {
            document.getElementById('devnetModal').style.display = 'flex';
        }

        function closeDevnetModal() {
            document.getElementById('devnetModal').style.display = 'none';
            localStorage.setItem('devnetModalShown', 'true');
        }

        // Show modal on first visit
        window.addEventListener('load', () => {
            const shown = localStorage.getItem('devnetModalShown');
            if (!shown) {
                setTimeout(showDevnetModal, 1000);
            }
            
            // Show faucet buttons
            document.getElementById('faucetBtn').style.display = 'block';
            document.getElementById('tamaFaucetBtn').style.display = 'block';
        });

        // üìä BETA TESTER TRACKING
        function trackBetaTester(action) {
            if (!window.solana || !window.solana.publicKey) return;
            
            const wallet = window.solana.publicKey.toString();
            let testerData = JSON.parse(localStorage.getItem('betaTester') || '{}');
            
            if (!testerData.wallet) {
                testerData = {
                    wallet: wallet,
                    joinedAt: Date.now(),
                    actions: [],
                    petsCreated: 0,
                    daysActive: []
                };
            }
            
            testerData.actions.push({
                action: action,
                timestamp: Date.now()
            });
            
            const today = new Date().toDateString();
            if (!testerData.daysActive) testerData.daysActive = [];
            if (!testerData.daysActive.includes(today)) {
                testerData.daysActive.push(today);
            }
            
            if (action === 'pet_created') {
                testerData.petsCreated = (testerData.petsCreated || 0) + 1;
            }
            
            localStorage.setItem('betaTester', JSON.stringify(testerData));
        }

        // Track actions throughout the game
        const originalCreatePet = window.createPet;
        if (originalCreatePet) {
            window.createPet = async function() {
                const result = await originalCreatePet();
                trackBetaTester('pet_created');
                return result;
            };
        }

        // üî• ==================================
        // CLOUDFLARE WORKERS API INTEGRATION
        // üî• ==================================

        // üìä Load game statistics
        async function loadGameStats() {
            try {
                const response = await fetch(`${WORKERS_API}/stats`);
                const stats = await response.json();
                
                document.getElementById('totalPets').textContent = stats.totalPets.toLocaleString();
                document.getElementById('totalPlayers').textContent = stats.totalPlayers.toLocaleString();
                document.getElementById('activeNow').textContent = stats.activeNow;
                document.getElementById('popularSpecies').textContent = stats.mostPopularSpecies;
                
                console.log('üìä Stats loaded:', stats);
            } catch (err) {
                console.error('‚ùå Error loading stats:', err);
                document.getElementById('totalPets').textContent = '-';
                document.getElementById('totalPlayers').textContent = '-';
                document.getElementById('activeNow').textContent = '-';
                document.getElementById('popularSpecies').textContent = '-';
            }
        }

        // üèÜ Load leaderboard
        async function loadLeaderboard() {
            try {
                const response = await fetch(`${WORKERS_API}/leaderboard`);
                const leaders = await response.json();
                
                let html = '';
                
                leaders.forEach(player => {
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 8px 0; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px);">
                            <span style="font-weight: bold; font-size: 20px; color: #FFD700; min-width: 40px;">#${player.rank}</span>
                            <span style="flex: 1; font-family: monospace; font-size: 13px; color: rgba(255,255,255,0.8); margin: 0 10px; overflow: hidden; text-overflow: ellipsis;">${player.wallet}</span>
                            <span style="color: #4facfe; margin: 0 10px; font-size: 14px;">${player.petName}</span>
                            <span style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 6px 12px; border-radius: 8px; font-weight: bold; color: white; font-size: 14px; min-width: 60px; text-align: center;">Lvl ${player.level}</span>
                            <span style="color: #43e97b; font-weight: bold; font-size: 14px; min-width: 80px; text-align: right;">${player.score.toLocaleString()} pts</span>
                        </div>
                    `;
                });
                
                document.getElementById('leaderboard-container').innerHTML = html;
                console.log('üèÜ Leaderboard loaded');
            } catch (err) {
                console.error('‚ùå Error loading leaderboard:', err);
                document.getElementById('leaderboard-container').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
                        Failed to load leaderboard
                    </div>
                `;
            }
        }

        // üéÅ Create referral link
        window.createReferralLink = async function() {
            if (!wallet) {
                showNotification('‚ùå Connect your wallet first!');
                return;
            }
            
            try {
                showNotification('üéÅ Creating referral link...');
                
                const response = await fetch(`${WORKERS_API}/referral/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wallet: wallet.publicKey.toString()
                    })
                });
                
                const data = await response.json();
                
                document.getElementById('referralCode').textContent = data.code;
                document.getElementById('referralLink').value = data.link;
                document.getElementById('referralBonus').textContent = data.bonus;
                document.getElementById('referralResult').style.display = 'block';
                
                showNotification(`‚úÖ Link created! Bonus: ${data.bonus} TAMA`);
                
                console.log('üéÅ Referral created:', data);
            } catch (err) {
                showNotification('‚ùå Error creating referral link');
                console.error(err);
            }
        }

        // üìã Copy referral link
        window.copyReferralLink = function() {
            const link = document.getElementById('referralLink').value;
            navigator.clipboard.writeText(link).then(() => {
                showNotification('‚úÖ Link copied to clipboard!');
            }).catch(() => {
                showNotification('‚ùå Failed to copy link');
            });
        }

        // üé≤ Generate random pet (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏)
        async function generateRandomPet() {
            try {
                const response = await fetch(`${WORKERS_API}/generate-pet`);
                const pet = await response.json();
                
                console.log('üê£ Random pet generated:', pet);
                return pet;
            } catch (err) {
                console.error('‚ùå Error generating pet:', err);
                return null;
            }
        }

        // ü§ñ AI Advisor
        window.askAIAdvisor = async function() {
            const question = document.getElementById('aiQuestion').value.trim();
            
            if (!question) {
                showNotification('‚ùå Please enter a question!');
                return;
            }
            
            try {
                showNotification('ü§ñ AI is thinking...');
                
                // Get pet stats if available
                const petStats = (typeof petData !== 'undefined' && petData) ? {
                    health: petData.health || 0,
                    hunger: petData.hunger || 0,
                    happiness: petData.happiness || 0
                } : null;
                
                const response = await fetch(`${WORKERS_API}/ai/advisor`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: question,
                        petStats: petStats
                    })
                });
                
                const data = await response.json();
                
                if (data.advice && data.advice.response) {
                    document.getElementById('aiAdviceText').textContent = data.advice.response;
                    document.getElementById('aiResponse').style.display = 'block';
                    showNotification('‚úÖ AI responded!');
                } else {
                    showNotification('‚ùå AI response failed');
                }
                
                console.log('ü§ñ AI Advice:', data);
            } catch (err) {
                showNotification('‚ùå Error contacting AI');
                console.error(err);
            }
        }

        // üìä –û–±–Ω–æ–≤–∏—Ç—å leaderboard —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        async function updateLeaderboardData() {
            if (!wallet || !realPetData) return;
            
            try {
                await fetch(`${WORKERS_API}/leaderboard/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wallet: wallet.publicKey.toString(),
                        level: realPetData.level || 1,
                        experience: realPetData.experience || 0,
                        petName: `–ü–∏—Ç–æ–º–µ—Ü #${realPetData.petId || '???'}`
                    })
                });
                
                console.log('‚úÖ Leaderboard updated');
            } catch (err) {
                console.log('‚ö†Ô∏è Failed to update leaderboard:', err);
            }
        }

        // üìú –î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
        async function addToHistory(action, details) {
            if (!wallet) return;
            
            try {
                await fetch(`${WORKERS_API}/history/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wallet: wallet.publicKey.toString(),
                        action: action,
                        details: details
                    })
                });
                
                console.log(`üìú Added to history: ${action}`);
            } catch (err) {
                console.log('‚ö†Ô∏è Failed to add to history:', err);
            }
        }

        // üìú –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–µ–π—Å—Ç–≤–∏–π
        window.loadHistory = async function() {
            if (!wallet) {
                showNotification('‚ùå Connect wallet first!');
                return;
            }
            
            try {
                showNotification('üìú Loading history...');
                
                const response = await fetch(`${WORKERS_API}/history/${wallet.publicKey.toString()}`);
                const history = await response.json();
                
                const historyListEl = document.getElementById('historyList');
                
                if (!history || history.length === 0) {
                    historyListEl.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.6);">
                            No actions yet. Start playing!
                        </div>
                    `;
                    showNotification('üìú No history found');
                    return;
                }
                
                let html = '';
                history.forEach(item => {
                    const date = new Date(item.timestamp);
                    const timeStr = date.toLocaleTimeString();
                    const dateStr = date.toLocaleDateString();
                    
                    const actionEmoji = {
                        'feed': 'üçñ',
                        'play': 'üéæ',
                        'heal': 'üíä',
                        'rest': 'üò¥'
                    };
                    
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 8px 0; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px);">
                            <span style="font-size: 24px;">${actionEmoji[item.action] || 'üéÆ'}</span>
                            <div style="flex: 1; margin: 0 15px;">
                                <div style="color: white; font-weight: bold; font-size: 14px;">${item.action.toUpperCase()}</div>
                                <div style="color: rgba(255,255,255,0.7); font-size: 12px;">${dateStr} ${timeStr}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #4caf50; font-size: 12px;">Level ${item.details?.petLevel || '-'}</div>
                                <div style="color: #ff4444; font-size: 12px;">HP ${item.details?.petHealth || '-'}</div>
                            </div>
                        </div>
                    `;
                });
                
                historyListEl.innerHTML = html;
                showNotification('‚úÖ History loaded!');
                console.log('üìú History loaded:', history.length, 'actions');
                
            } catch (err) {
                showNotification('‚ùå Failed to load history');
                console.error(err);
            }
        }

        // üîÑ –û–±–Ω–æ–≤–ª—è–µ–º leaderboard –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏–π
        const originalPerformAction = window.performAction;
        if (originalPerformAction) {
            window.performAction = async function(actionType) {
                const result = await originalPerformAction(actionType);
                
                // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –æ–±–Ω–æ–≤–ª—è–µ–º leaderboard –∏ –∏—Å—Ç–æ—Ä–∏—é
                if (result !== false) {
                    await updateLeaderboardData();
                    await addToHistory(actionType, {
                        timestamp: Date.now(),
                        petLevel: realPetData?.level || 1,
                        petHealth: realPetData?.health || 100
                    });
                }
                
                return result;
            };
        }

        // üí¨ CHAT FUNCTIONS
        let chatMessages = [];
        
        async function loadChatMessages() {
            try {
                const response = await fetch(`${WORKERS_API}/chat/messages`);
                const messages = await response.json();
                chatMessages = messages || [];
                displayChatMessages();
                console.log('üí¨ Chat loaded:', chatMessages.length, 'messages');
            } catch (err) {
                console.log('‚ö†Ô∏è Failed to load chat:', err);
                chatMessages = [
                    {
                        wallet: 'System',
                        message: 'Welcome to Tamagotchi Chat! üéÆ',
                        timestamp: Date.now()
                    }
                ];
                displayChatMessages();
            }
        }
        
        function displayChatMessages() {
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) return;
            
            if (chatMessages.length === 0) {
                chatContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <p style="font-size: 48px; margin-bottom: 10px;">üí¨</p>
                        <p>No messages yet. Be the first to chat!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            chatMessages.slice(-50).reverse().forEach(msg => {
                const date = new Date(msg.timestamp);
                const timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                const walletShort = msg.wallet === 'System' ? 'System ü§ñ' : msg.wallet.slice(0, 4) + '...' + msg.wallet.slice(-4);
                const isCurrentUser = wallet && msg.wallet === wallet.publicKey.toString();
                
                html += `
                    <div style="margin-bottom: 15px; ${isCurrentUser ? 'text-align: right;' : ''}">
                        <div style="display: inline-block; max-width: 80%; text-align: left; background: ${isCurrentUser ? 'rgba(67, 233, 123, 0.3)' : 'rgba(255,255,255,0.2)'}; padding: 12px 15px; border-radius: 15px; ${isCurrentUser ? 'border-bottom-right-radius: 5px;' : 'border-bottom-left-radius: 5px;'}">
                            <div style="color: rgba(255,255,255,0.8); font-size: 12px; margin-bottom: 5px; font-weight: 600;">
                                ${walletShort} ‚Ä¢ ${timeStr}
                            </div>
                            <div style="color: white; font-size: 14px; word-wrap: break-word;">
                                ${escapeHtml(msg.message)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            chatContainer.innerHTML = html;
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        async function sendChatMessage() {
            if (!wallet) {
                showNotification('‚ùå Connect wallet to chat!');
                return;
            }
            
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) {
                showNotification('‚ùå Message cannot be empty!');
                return;
            }
            
            if (message.length > 200) {
                showNotification('‚ùå Message too long! Max 200 characters.');
                return;
            }
            
            try {
                const response = await fetch(`${WORKERS_API}/chat/send`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        wallet: wallet.publicKey.toString(),
                        message: message
                    })
                });
                
                if (response.ok) {
                    input.value = '';
                    await loadChatMessages();
                    showNotification('‚úÖ Message sent!');
                } else {
                    showNotification('‚ùå Failed to send message');
                }
            } catch (err) {
                console.error('Chat error:', err);
                showNotification('‚ùå Chat error');
            }
        }
        
        // üöÄ Initialize API features on page load
        window.addEventListener('load', () => {
            console.log('‚ö° Initializing Cloudflare Workers API...');
            console.log('üì° API URL:', WORKERS_API);
            console.log('üíæ KV Database: ENABLED');
            
            // Load stats and leaderboard
            loadGameStats();
            loadLeaderboard();
            loadChatMessages();  // Load chat
            
            // Update every 30 seconds
            setInterval(() => {
                loadGameStats();
                loadLeaderboard();
                loadChatMessages();  // Refresh chat
            }, 30000);
            
            console.log('‚úÖ API features initialized!');
        });
    </script>

</body>
</html>



